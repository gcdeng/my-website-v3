<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Eric Deng Blog</title>
        <link>https://gcdeng.com/blog</link>
        <description>Eric Deng Blog</description>
        <lastBuildDate>Sun, 14 Nov 2021 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <item>
            <title><![CDATA[[å‰ç«¯å„ªåŒ–ç³»åˆ—]Web Vitalså„ªåŒ–æ–¹æ³•æ‡¶äººåŒ…]]></title>
            <link>https://gcdeng.com/blog/a-guidebook-to-optimize-web-vitals</link>
            <guid>a-guidebook-to-optimize-web-vitals</guid>
            <pubDate>Sun, 14 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[é€™ç¯‡æ–‡ç« ä»‹ç´¹äº† Web Vitalsã€æ¸¬é‡æ–¹å¼ä»¥åŠå„ªåŒ–æ–¹æ³•ï¼Œå…¶ä¸­å„ªåŒ–æ–¹æ³•æœƒéš¨è‘—è‡ªå·±çš„å¯¦å‹™ç¶“é©—åŠç ”ç©¶æŒçºŒæ›´æ–°ï¼Œå¸Œæœ›å¯ä»¥æˆç‚ºå„ªåŒ–æ•ˆèƒ½ç”¨çš„æ‡¶äººåŒ…ï¼Œåœ¨é–‹ç™¼åŠŸèƒ½æ™‚ä½œç‚ºæé†’è‡ªå·±æœƒå½±éŸ¿æ•ˆèƒ½çš„æ³¨æ„äº‹é …ï¼Œè¦å„ªåŒ–ç¶²ç«™æ™‚ä¹Ÿæ–¹ä¾¿å›ä¾†æ‰¾å¯¦ä½œçš„æ–¹å‘ã€‚]]></description>
            <content:encoded><![CDATA[<p>é€™ç¯‡æ–‡ç« ä»‹ç´¹äº† Web Vitalsã€æ¸¬é‡æ–¹å¼ä»¥åŠå„ªåŒ–æ–¹æ³•ï¼Œå…¶ä¸­å„ªåŒ–æ–¹æ³•æœƒéš¨è‘—è‡ªå·±çš„å¯¦å‹™ç¶“é©—åŠç ”ç©¶æŒçºŒæ›´æ–°ï¼Œå¸Œæœ›å¯ä»¥æˆç‚ºå„ªåŒ–æ•ˆèƒ½ç”¨çš„æ‡¶äººåŒ…ï¼Œåœ¨é–‹ç™¼åŠŸèƒ½æ™‚ä½œç‚ºæé†’è‡ªå·±æœƒå½±éŸ¿æ•ˆèƒ½çš„æ³¨æ„äº‹é …ï¼Œè¦å„ªåŒ–ç¶²ç«™æ™‚ä¹Ÿæ–¹ä¾¿å›ä¾†æ‰¾å¯¦ä½œçš„æ–¹å‘ã€‚</p><p><img src="/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/kate-stone-matheson-uy5t-CJuIK4-unsplash.jpg" alt="kate-stone-matheson-uy5t-CJuIK4-unsplash.jpg"/>Photo by Kate Stone Matheson on Unsplash</p><h2>ç›®éŒ„</h2><ul><li><a href="#%E4%BB%80%E9%BA%BC%E6%98%AF-web-vitals">ä»€éº¼æ˜¯ Web Vitals?</a></li><li><a href="#%E5%A6%82%E4%BD%95%E6%B8%AC%E9%87%8F%E7%B6%B2%E7%AB%99%E7%9A%84-web-vitals%EF%BC%9F">å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„ Web Vitalsï¼Ÿ</a><ul><li><a href="#%E5%AF%A6%E9%A9%97%E6%A8%A1%E6%93%AC%E6%B8%AC%E9%87%8Fin-the-lab">å¯¦é©—æ¨¡æ“¬æ¸¬é‡(In the lab)</a></li><li><a href="#%E5%AF%A6%E6%B8%ACin-the-field">å¯¦æ¸¬(In the field)</a></li><li><a href="#%E5%A6%82%E4%BD%95%E5%B0%87%E6%B8%AC%E9%87%8F%E5%B7%A5%E5%85%B7%E5%B0%8E%E5%85%A5%E7%94%A2%E5%93%81%E9%96%8B%E7%99%BC%E6%B5%81%E7%A8%8B%E4%B8%AD">å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­</a></li></ul></li><li><a href="#%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6loading-performance">è¼‰å…¥é€Ÿåº¦(Loading Performance)</a><ul><li><a href="#largest-contentful-paint-lcp">Largest Contentful Paint (LCP)</a></li><li><a href="#first-contentful-paint-fcp">First Contentful Paint (FCP)</a></li><li><a href="#time-to-first-byte-ttfb">Time to First Byte (TTFB)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E4%BA%92%E5%8B%95%E5%8F%8D%E6%87%89%E8%83%BD%E5%8A%9Binteractivity">äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)</a><ul><li><a href="#first-input-delay-fid">First Input Delay (FID)</a></li><li><a href="#time-to-interactive-tti">Time to Interactive (TTI)</a></li><li><a href="#total-blocking-time-tbt">Total Blocking Time (TBT)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95-1">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E8%A6%96%E8%A6%BA%E7%A9%A9%E5%AE%9A%E6%80%A7visual-stability">è¦–è¦ºç©©å®šæ€§(Visual Stability)</a><ul><li><a href="#cumulative-layout-shift-cls">Cumulative Layout Shift (CLS)</a></li><li><a href="#speed-index-si">Speed Index (SI)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95-2">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E7%B8%BD%E7%B5%90">ç¸½çµ</a></li><li><a href="#reference">Reference</a></li></ul><h2>ä»€éº¼æ˜¯ Web Vitals?</h2><p><strong>Web Vitals</strong>æ˜¯ç”± Google æå‡ºè¡¡é‡ç¶²ç«™æ•ˆèƒ½åŠä½¿ç”¨é«”é©—çš„é‡åŒ–æŒ‡æ¨™ï¼Œå¯ä»¥å¹«åŠ©é–‹ç™¼è€…åšç‚ºå„ªåŒ–ç¶²ç«™çš„åƒè€ƒã€‚ä»¥ä½¿ç”¨è€…é«”é©—ç‚ºä¸­å¿ƒæå‡ºäº†ä¸‰å€‹æ”¹å–„é¢å‘ï¼Œæ¯å€‹é¢å‘æœ‰ä»¥ä¸‹å„è‡ªå°æ‡‰çš„æŒ‡æ¨™ï¼š</p><ol><li>è¼‰å…¥é€Ÿåº¦(Loading Performance)<ol><li><strong>Largest Contentful Paint (LCP)</strong></li><li>First Contentful Paint (FCP)</li><li>Time to First Byte (TTFB)</li></ol></li><li>äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)<ol><li><strong>First Input Delay (FID)</strong></li><li>Time to Interactive (TTI)</li><li>Total Blocking Time (TBT)</li></ol></li><li>è¦–è¦ºç©©å®šæ€§(Visual Stability)<ol><li><strong>Cumulative Layout Shift (CLS)</strong></li><li>Speed Index (SI)</li></ol></li></ol><p>å…¶ä¸­<strong>LCP, FID, CLS</strong>æ˜¯ä¸‰å€‹è¼ƒç‚ºé‡è¦ä»£è¡¨å„é¢å‘çš„<strong>æ ¸å¿ƒæŒ‡æ¨™(Core Web Vitals)</strong>ã€‚</p><h2>å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„ Web Vitalsï¼Ÿ</h2><p>æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥å¹«æˆ‘å€‘è§£æç¶²ç«™æ•ˆèƒ½ï¼Œä¸¦ä¸”ç”¢ç”Ÿå‡ºé€™äº›é‡åŒ–æŒ‡æ¨™åˆ†æ•¸ä»¥åŠæ”¹å–„å»ºè­°çš„åˆ†æå ±å‘Šï¼Œä¾ç…§ç’°å¢ƒåˆ†æˆå…©ç¨®æ¸¬é‡æ–¹å¼ï¼Œä¸åŒæ–¹å¼æœ‰å„è‡ªçš„å·¥å…·ï¼š</p><h3>å¯¦é©—æ¨¡æ“¬æ¸¬é‡(In the lab)</h3><p>æ¨¡æ“¬æ¸¬é‡å·¥å…·æœƒå»æ¨¡æ“¬ä½¿ç”¨è€…çš„æ“ä½œè¡Œç‚ºï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™è©•åˆ†ï¼Œæä¾›å¯ä»¥é‡ç¾çš„çµæœï¼Œé©åˆç”¨åœ¨ç”¢å“é–‹ç™¼éšæ®µåšåˆ†æåŠé©—è­‰ã€‚</p><ul><li><a href="https://developers.google.com/web/tools/lighthouse/">Lighthouse</a></li><li><a href="https://github.com/GoogleChrome/lighthouse-ci">Lighthouse CI</a>ï¼Œè¨­å®šåœ¨ PR æ™‚è‡ªå‹•åŒ–è·‘ Lighthouse ç”¢ç”Ÿæ¸¬é‡å ±å‘Šã€‚</li><li><a href="https://developer.chrome.com/docs/devtools/evaluate-performance/">Chrome DevTools Performance panel</a>ï¼Œå¯ä»¥éŒ„è£½ç•«é¢ï¼Œæ›´æ·±å…¥é‡å°æŸæ®µ frame åšå„ªåŒ–ã€‚</li><li><a href="https://webpagetest.org/">WebPageTest</a></li></ul><h3>å¯¦æ¸¬(In the field)</h3><p>ä¹Ÿè¢«ç¨±ç‚º Real User Monitoring(RUM)ï¼Œå¯¦æ¸¬å·¥å…·æœƒä½¿ç”¨å¾çœŸå¯¦ä½¿ç”¨è€…è’é›†ä¾†çš„åŒ¿åä½¿ç”¨è¡Œç‚ºè³‡æ–™è©•åˆ†ï¼Œå¯ä»¥çŸ¥é“ä½¿ç”¨è€…çœŸå¯¦é«”é©—ç‹€æ³ï¼Œä½†åˆ†æ•¸ä¹Ÿæœƒå—ä½¿ç”¨è€…ç•¶ä¸‹è£ç½®å½±éŸ¿ï¼Œä¾‹å¦‚ä½¿ç”¨è€…çš„ç¶²è·¯ç‹€æ³ä¸ä½³ï¼Œæˆ–æ˜¯æ¯å€‹ä½¿ç”¨è€…æœƒé¡¯ç¤ºä¸åŒçš„å®¢è£½åŒ–è³‡æ–™ï¼Œéƒ½æœƒå½±éŸ¿æ¸¬é‡è©•åˆ†ï¼Œå› æ­¤å¯èƒ½æœƒè·Ÿæ¨¡æ“¬æ¸¬é‡çµæœæœ‰å·®è·ã€‚</p><ul><li><a href="https://developers.google.com/speed/pagespeed/insights/?hl=zh-TW">PageSpeed Insights</a></li><li><a href="https://search.google.com/search-console/about">Search Console</a></li><li><a href="https://developers.google.com/web/tools/chrome-user-experience-report">Chrome User Experience Report</a> API</li><li><a href="https://firebase.google.com/docs/perf-mon">Firebase Performance Monitoring</a></li><li><a href="https://github.com/GoogleChrome/web-vitals-extension">Web Vitals Chrome Extension</a></li></ul><p>å¦‚æœéœ€è¦æ›´è©³ç´°çš„ä½¿ç”¨è¡Œç‚ºè³‡æ–™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/GoogleChrome/web-vitals">web-vitals</a> javascript libraryï¼Œåœ¨è‡ªå·±çš„å°ˆæ¡ˆä¸­å¯¦ä½œ Real User Monitoringï¼Œä¾†è§€å¯Ÿä½¿ç”¨è€…å¯¦éš›æ“ä½œç´°ç¯€ï¼Œé©—è­‰åœ¨ç”¢å“ç’°å¢ƒä¸­æ•ˆèƒ½å•é¡Œæ˜¯å¦æœ‰æ”¹å–„ã€‚</p><blockquote><p>é€™ç¯‡æ–‡ç« ä¸æœƒå¤ªè©³ç´°è§£é‡‹æ¯å€‹æ¸¬é‡å·¥å…·è¨ˆç®—æŒ‡æ¨™åˆ†æ•¸çš„å…¬å¼ï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒå„æŒ‡æ¨™çš„æ¨™é¡Œè¶…é€£çµã€‚</p></blockquote><h3>å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­</h3><p>åƒè€ƒ <a href="https://web.dev/i18n/en/vitals-tools/">https://web.dev/i18n/en/vitals-tools/</a> æåˆ°çš„æµç¨‹</p><ol><li>ä½¿ç”¨ Search Console ç”¢ç”Ÿæ¯å€‹é é¢çš„æ ¸å¿ƒæŒ‡æ¨™æ¸¬é‡å ±å‘Šï¼Œæ‰¾åˆ°å“ªå€‹é é¢éœ€è¦ç‰¹åˆ¥é€²è¡Œå„ªåŒ–ã€‚</li><li>æ‰¾åˆ°éœ€è¦å„ªåŒ–çš„é é¢ URLï¼Œä½¿ç”¨ PageSpeed Insights æˆ–å…¶ä»– RUM å·¥å…·å¾—åˆ°åŒ…å« lab åŠ field çš„è©³ç´°æŒ‡æ¨™æ¸¬é‡çµæœè·Ÿå„ªåŒ–å»ºè­°ã€‚</li><li>åœ¨æœ¬åœ°é–‹ç™¼ç’°å¢ƒé…åˆå„ªåŒ–å»ºè­°é€²è¡Œä¿®æ­£ï¼Œé…åˆ Lighthouse è·Ÿ Chrome DevTools åšé©—è­‰ã€‚</li><li>ä½¿ç”¨ Lighthouse CI åœ¨ PR è‡ªå‹•åŒ–æ¸¬é‡ï¼Œé€šéè¨­å®šçš„æŒ‡æ¨™åˆ†æ•¸é–€æª»å¾Œæ‰ merge é€²ä¸»ç·šç„¶å¾Œ deploy productionã€‚</li><li>å›åˆ°æ­¥é©Ÿ 1 è·Ÿ 2ï¼Œé©—è­‰çœŸå¯¦ç”¢å“ç’°å¢ƒä¸­çš„æŒ‡æ¨™åˆ†æ•¸æ˜¯å¦çœŸçš„æœ‰å„ªåŒ–æˆåŠŸã€‚</li></ol><h2>è¼‰å…¥é€Ÿåº¦(Loading Performance)</h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é å¯ä»¥å¤šå¿«è¼‰å…¥å®Œæˆä¸¦ä¸”æ¸²æŸ“å¥½ç•«é¢ã€‚</p><h3><a href="https://web.dev/lcp/">Largest Contentful Paint (LCP)</a></h3><p><code>core web vital</code></p><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°æœ€å¤§é¢ç©çš„å…ƒç´ æ¸²æŸ“(render)åˆ°ç•«é¢ä¸Šæ‰€èŠ±çš„æ™‚é–“ã€‚</p><p><img src="/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/LCP.svg" alt="LCP.svg"/></p><h3><a href="https://web.dev/fcp/">First Contentful Paint (FCP)</a></h3><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°ä»»ä½•ä¸€å€‹å…ƒç´ æ¸²æŸ“åˆ°ç•«é¢ä¸Šæ‰€èŠ±çš„æ™‚é–“ã€‚</p><h3><a href="https://web.dev/ttfb/">Time to First Byte (TTFB)</a></h3><p>ç€è¦½å™¨å°ä¼ºæœå™¨ç™¼å‡ºè«‹æ±‚(ex: http api request)å¾Œåˆ°æ”¶åˆ°å›æ‡‰è³‡æ–™(ç¬¬ä¸€å€‹ byte)æ‰€èŠ±çš„æ™‚é–“ã€‚</p><h3>å„ªåŒ–æ–¹æ³•</h3><ul><li>åŠ é€Ÿå–å¾—è³‡æºçš„æ™‚é–“<ul><li>Cache<ul><li>CDN caching<ul><li>ä¾‹å¦‚ä½¿ç”¨ SSG å°‡éœæ…‹ HTML cache åœ¨ CDN</li></ul></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching">HTTP caching</a></li><li>service worker <a href="https://developers.google.com/web/tools/workbox/modules/workbox-precaching">Workbox Precaching</a></li><li>server cachingï¼Œå°‡éœæ…‹æª”æ¡ˆ cache åœ¨ server-side disk<ul><li>reverse proxies (Varnish, nginx)</li><li>cloud provider (Firebase, AWS, Azure)</li><li>CDN edge servers</li></ul></li></ul></li><li>åœ¨çœŸæ­£éœ€è¦åŸ·è¡Œä¹‹å‰é å…ˆä¸‹è¼‰å¥½è³‡æºï¼Œè¦ç”¨æ™‚å¯ä»¥ç›´æ¥é–‹å§‹åŸ·è¡Œï¼Œä½¿ç”¨ Resource Hints <code>preload</code>, <code>prefetch</code>ï¼Œä¾‹å¦‚ prefetch åˆ†é çš„ä¸‹ä¸€é æœƒç”¨åˆ°çš„è³‡æº</li><li>é å…ˆèˆ‡è³‡æºæœå‹™å™¨å»ºç«‹é€£ç·šï¼Œè¦ç”¨æ™‚å¯ä»¥æ›´å¿«ä¸‹è¼‰åˆ°è³‡æºï¼Œä½¿ç”¨ Resource Hints <code>dns-prefetch</code>, <code>preconnect</code>ï¼Œä¾‹å¦‚<a href="https://web.dev/optimize-lcp/#establish-third-party-connections-early">æ—©ä¸€é»èˆ‡ third-party å»ºç«‹é€£ç·š</a></li><li>æ¸›å°‘ HTTP request æ•¸é‡</li><li>åŠ é€Ÿå¾Œç«¯ä¼ºæœå™¨å›æ‡‰é€Ÿåº¦ï¼Œä¾‹å¦‚å„ªåŒ– DB query</li></ul></li><li>æ¸›å°‘è³‡æºé«”ç©ï¼Œæ›´å¿«å–å¾—åŠåŸ·è¡Œè³‡æºå…§å®¹<ul><li>æ¸›å°‘ server remote API response data é«”ç©ï¼Œä¾‹å¦‚ä¸æ‹¿å¤šé¤˜ç”¨ä¸åˆ°çš„è³‡æ–™</li><li>dynamic importï¼Œåœ¨éœ€è¦ç”¨åˆ°æ™‚æ‰è¼‰å…¥ module</li><li>route-based code splittingï¼Œç‰¹å®šé é¢åªè¼‰å…¥ç›¸é—œçš„è…³æœ¬èˆ‡æ¨£å¼æª”</li><li>tree shaking</li><li>partial importï¼Œåªå¾ module ä¸­è¼‰å…¥éœ€è¦ç”¨çš„ functionï¼Œä¸æ˜¯è¼‰å…¥æ•´å€‹ module</li><li>æ”¹å–„ webpack chunk è¨­å®šï¼Œæ¸›å°‘ bundle size</li><li>æ”¹å–„å¥—ä»¶ä½¿ç”¨æ–¹å¼ï¼Œç›¡é‡æŒ‘é¸é«”ç©å°çš„å¥—ä»¶ï¼Œç§»é™¤å¤šé¤˜å¼•ç”¨çš„å¥—ä»¶</li><li>åˆ†æ bundle size å·¥å…·ï¼š<ul><li><a href="https://www.npmjs.com/package/webpack-bundle-analyzer">Webpack Bundle Analyzer</a></li><li><a href="https://www.npmjs.com/package/source-map-explorer">source-map-explorer</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost">Import Cost VSCode Extension</a></li></ul></li><li>ç²¾ç°¡ç¨‹å¼ç¢¼: åˆªé™¤ç”¨ä¸åˆ°çš„ç¨‹å¼ç¢¼ã€minify js &amp; css</li><li><a href="https://web.dev/serve-modern-code-to-modern-browsers/">æ¸›å°‘ polyfills é«”ç©</a><ul><li>ä½¿ç”¨@babel/preset-env åªé‡å°è¦æ”¯æ´çš„ç€è¦½å™¨ä½¿ç”¨ polyfill</li></ul></li></ul></li><li>ç€è¦½å™¨åœ¨ä¸‹è¼‰æˆ–åŸ·è¡Œè³‡æº(js, css)æ™‚æœƒæš«åœè§£æ HTML DOM åŠå»¶é²æ¸²æŸ“ç•«é¢(<strong>render-blocking</strong>)ï¼Œå› æ­¤æ¸›å°‘ render-blocking æ™‚é–“ä¹Ÿæ˜¯ä¸€å€‹æ–¹æ³•<ul><li>CSR å› ç‚ºæœ‰å¾ˆå¤š JS éœ€è¦åœ¨ç€è¦½å™¨åŸ·è¡Œï¼Œå° LCP å½±éŸ¿è¼ƒå¤§ï¼Œå¯ä»¥è€ƒæ…®æ”¹æˆä½¿ç”¨ server-side rendering æˆ–æ˜¯å…¶ä»– pre-rendering æ–¹å¼ï¼Œä½†å¯èƒ½ä¹Ÿæœƒå° TTFB åŠ TTI é€ æˆè² é¢å½±éŸ¿ï¼Œéœ€è¦è©•ä¼°æ˜¯å¦é©åˆè‡ªå·±çš„å°ˆæ¡ˆ</li><li>script tag ä½¿ç”¨ async å±¬æ€§ï¼Œè®“ js å¯ä»¥åœ¨èƒŒæ™¯ä¸‹è¼‰ä¸é˜»æ“‹æ¸²æŸ“ç•«é¢</li><li>script tag ä½¿ç”¨ defer å±¬æ€§ï¼Œè®“éé—œéµçš„ js å¯ä»¥å»¶é²åŸ·è¡Œä¸é˜»æ“‹æ¸²æŸ“ç•«é¢</li><li><a href="https://web.dev/optimize-lcp/#defer-non-critical-css">å»¶é²è¼‰å…¥éé—œéµçš„ CSS</a><ul><li><a href="https://github.com/filamentgroup/loadCSS">loadCSS</a></li></ul></li><li>åŠ é€Ÿå–å¾—è³‡æºçš„æ™‚é–“ä»¥åŠæ¸›å°‘è³‡æºé«”ç©ä¹Ÿå¯ä»¥å¹«åŠ©æ¸›å°‘ render-blocking æ™‚é–“</li></ul></li><li>å„ªåŒ–åœ–ç‰‡<ul><li><a href="https://web.dev/serve-responsive-images/">éŸ¿æ‡‰å¼åœ–æª”</a>ï¼Œæ ¹æ“šè£ç½®å°ºå¯¸æ‹¿å–å°æ‡‰è¶³å¤ çš„åœ–ç‰‡å°ºå¯¸</li><li>ä½¿ç”¨ WebPã€AVIF æ ¼å¼</li><li>Image Server (<a href="https://cloudinary.com/">Cloudinary</a>)</li><li>lazy loading</li><li>å£“ç¸®åœ–ç‰‡(<a href="https://web.dev/use-imagemin-to-compress-images/">Imagemin</a>)</li></ul></li></ul><h2>äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)</h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é å¤šå¿«å¯ä»¥å›æ‡‰ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºï¼Œä¾‹å¦‚æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œå¤šä¹…æœƒæœ‰åæ‡‰ã€‚</p><h3><a href="https://web.dev/fid/">First Input Delay (FID)</a></h3><p><code>core web vital</code></p><p>ä½¿ç”¨è€…é¦–æ¬¡èˆ‡ç¶²ç«™äº’å‹•ï¼Œç›´åˆ°ç€è¦½å™¨å›æ‡‰äº’å‹•äº‹ä»¶çš„æ™‚é–“å·®ã€‚é€™å€‹æŒ‡æ¨™æœƒå› ç‚ºçœŸå¯¦ä½¿ç”¨è€…é¦–æ¬¡äº’å‹•è¡Œç‚ºè€Œæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥åªèƒ½å¯¦æ¸¬(field)ç„¡æ³•æ¨¡æ“¬æ¸¬é‡(lab)ã€‚åœ¨é–‹ç™¼éšæ®µå› ç‚ºæ²’æœ‰è¾¦æ³•å¯¦æ¸¬ï¼Œå¯ä»¥è—‰ç”±å„ªåŒ–æœ‰é—œè¯æ€§çš„ TBT æŒ‡æ¨™ä¾†å”åŠ©æ”¹å–„ FIDã€‚</p><p><img src="/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/FID.svg" alt="FID.svg"/></p><h3><a href="https://web.dev/tti/">Time to Interactive (TTI)</a></h3><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°é•·æ™‚é–“ä»»å‹™(long tasks)éƒ½å·²ç¶“çµæŸè€Œä¸”å¯ä»¥å›æ‡‰ä½¿ç”¨è€…äº’å‹•æ‰€èŠ±çš„æ™‚é–“ã€‚</p><p>é•·æ™‚é–“ä»»å‹™(long tasks)æ˜¯æŒ‡è¶…é 50ms çš„ä»»å‹™ï¼Œå¯èƒ½æ˜¯è§£æ HTML å»ºç«‹ DOM Treeã€è§£æ CSS å¥—ç”¨æ¨£å¼ã€åŸ·è¡Œ JS ç­‰ã€‚</p><h3><a href="https://web.dev/tbt/">Total Blocking Time (TBT)</a></h3><p>ä¸»åŸ·è¡Œç·’è¢«é•·æ™‚é–“ä»»å‹™(long tasks)é˜»å¡çš„ç¸½æ™‚é–“ï¼Œé˜»å¡çš„æ™‚é–“æ˜¯æŒ‡é•·æ™‚é–“ä»»å‹™ä¸­è¶…é 50ms çš„æ™‚é–“(long task time - 50ms)ï¼Œå°‡æ¯å€‹ long task é˜»å¡æ™‚é–“åšç¸½å’Œå°±æ˜¯ TBTï¼Œé€™æ®µæ™‚é–“è¢«è¦–ç‚ºç„¡æ³•å›æ‡‰ä½¿ç”¨è€…äº’å‹•çš„æ™‚é–“ã€‚</p><h3>å„ªåŒ–æ–¹æ³•</h3><p>å»¶é²äº’å‹•å›æ‡‰æ™‚é–“çš„ä¸»è¦åŸå› æ˜¯ç¹é‡çš„ js åŸ·è¡Œä»»å‹™ä½”ç”¨è‘—ä¸»åŸ·è¡Œç·’ï¼Œè®“ç€è¦½å™¨ç„¡æ³•è™•ç†ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºäº‹ä»¶ï¼Œå› æ­¤<strong><a href="https://web.dev/mainthread-work-breakdown/">æ¸›å°‘ä¸»åŸ·è¡Œç·’è² æ“”</a>å¯ä»¥æœ‰æ•ˆæ”¹å–„</strong>ã€‚</p><ul><li>æ¸›å°‘ JS åŸ·è¡Œæ™‚é–“ï¼Œå¯ä»¥åƒè€ƒä¸Šè¿°å·²ç¶“æåˆ°çš„æ–¹æ³•</li><li>æ‹†åˆ† long taskï¼Œcode-split js bundle æ‹†åˆ†æˆå¤šå€‹å¯ä»¥éåŒæ­¥åŸ·è¡Œçš„å°æª”æ¡ˆ(chunk)ï¼Œé…åˆ async, defer å±¬æ€§</li><li>å»¶é²åŸ·è¡Œä¸é‡è¦çš„è³‡æºï¼Œä¾‹å¦‚ä½¿ç”¨ script tag defer å±¬æ€§</li><li>ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker">web workers</a>ï¼Œè®“ js åœ¨å¦ä¸€å€‹èƒŒæ™¯åŸ·è¡Œç·’åŸ·è¡Œï¼Œå¥—ä»¶: <a href="https://github.com/GoogleChromeLabs/comlink">Comlink</a></li><li>å…ˆæº–å‚™å¥½äº’å‹•è¡Œç‚ºéœ€è¦çš„è³‡æ–™ï¼Œä¾‹å¦‚ç›¡é‡é¿å…åœ¨äº’å‹•æ™‚æ‰å»æ‰“ api fetch è³‡æ–™</li><li>Debounce</li><li>Throttle</li></ul><h2>è¦–è¦ºç©©å®šæ€§(Visual Stability)</h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é ä¸Šçš„å…ƒç´ æ˜¯å¦ç™¼ç”Ÿæœªé æœŸçš„ä½ç½®æ”¹è®Šè€Œå½±éŸ¿ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºï¼Œä¾‹å¦‚è¦æŒ‰ä¸‹æŒ‰éˆ•æ™‚çªç„¶è·³å‡ºå»£å‘Šã€‚ä»¥åŠè©•ä¼°è½‰å ´æˆ–å‹•ç•«çš„æ¸²æŸ“æœ‰ç¶­æŒä¸€å®šçš„ frame rateï¼Œç•«é¢ä¸Šæ¯å€‹ç‹€æ…‹çš„æ”¹è®Šæ˜¯æµæš¢çš„ã€‚</p><h3><a href="https://web.dev/cls/">Cumulative Layout Shift (CLS)</a></h3><p><code>core web vital</code></p><p>ç´¯è¨ˆä½ˆå±€åç§»ï¼Œç•«é¢ç™¼ç”Ÿæœªé æœŸæ’ç‰ˆç§»å‹•çš„ç¨‹åº¦ï¼Œä¾‹å¦‚çªç„¶æ»‘å‡ºä¾†çš„å»£å‘Šå°±æœƒæœ‰å¾ˆå¤§çš„å½±éŸ¿ï¼Œè¼ƒä½çš„ CLS åˆ†æ•¸å¯ä»¥æœ‰åŠ©æ–¼è¦–è¦ºé«”é©—ä¸Šçš„èˆ’é©åº¦ã€‚</p><p><img src="/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/CLS.svg" alt="CLS.svg"/></p><h3><a href="https://web.dev/speed-index/">Speed Index (SI)</a></h3><p>ç¶²é è¼‰å…¥æœŸé–“å…§å®¹èƒ½å¤šå¿«è¢«ä½¿ç”¨è€…çœ‹åˆ°ï¼Œç”¨ä¾†è¡¡é‡è¦–è¦ºçš„æµæš¢æ€§ã€‚æ¸¬é‡å·¥å…·æœƒåœ¨ç¶²é è¼‰å…¥æœŸé–“éŒ„è£½å½±ç‰‡ï¼Œè¨ˆç®—æ¯å€‹ frame åœ¨è¦–è¦ºä¸Šçš„å…§å®¹å®Œæˆé€²åº¦ã€‚</p><h3>å„ªåŒ–æ–¹æ³•</h3><ul><li>img, video, iframe è¨­å®š width, height å±¬æ€§ï¼Œæˆ–æ˜¯<a href="https://web.dev/optimize-cls/#images-without-dimensions">å¯¬é«˜æ¯”</a></li><li>é¿å…åœ¨ç¾æœ‰å…§å®¹ä¸Šæ–¹æ’å…¥å‹•æ…‹è¼‰å…¥çš„å…§å®¹ï¼Œå°è‡´æ¨æ“ åˆ°å…¶ä»–å…ƒä»¶çš„æ’ç‰ˆï¼Œå¯ä»¥å…ˆé ç•™å¥½éœ€è¦çš„ç©ºé–“(<a href="https://css-tricks.com/aspect-ratio-boxes/">CSS aspect ratio boxes</a>)ï¼Œæˆ–æ˜¯å°‡å—å½±éŸ¿çš„æ’ç‰ˆç§»åˆ°å¯è¦–ç¯„åœä¹‹å¤–</li><li>é¿å…çªç„¶ç§»å‹•æˆ–è“‹æ¿çš„å…§å®¹ï¼Œä¾‹å¦‚å»£å‘Šçªç„¶è·³å‡ºä¾†</li><li><a href="https://web.dev/optimize-cls/#web-fonts-causing-foutfoit">é˜²æ­¢ FOIT (flash of invisible text) æ–‡å­—çªç„¶å‡ºç¾ã€FOUT (flash of unstyled text) å­—é«”çªç„¶æ”¹è®Š</a><ul><li>ä½¿ç”¨<code>&lt;link rel=preload&gt;</code> ææ—©ä¸‹è¼‰å­—é«”ï¼Œ@font-face åŠ ä¸Š <code>font-display: optional</code> [<a href="https://web.dev/preload-optional-fonts/">åƒè€ƒ</a>]</li><li>google fonts url åŠ ä¸Š<code>&amp;display=swap</code></li></ul></li><li><a href="https://web.dev/optimize-cls/#animations">ç›¡é‡ä½¿ç”¨<code>transform</code>åšå‹•ç•«</a>ï¼Œç€è¦½å™¨é‹ç®—æˆæœ¬è¼ƒä½</li></ul><p>åœ¨å¯¦ä½œè¦–è¦ºç©©å®šæ€§çš„æ”¹å–„é€šå¸¸æœƒéœ€è¦ä½¿ç”¨åˆ°<a href="https://developer.chrome.com/docs/devtools/evaluate-performance/">Chrome DevTools Performance panel</a>ï¼Œå»åˆ†ææ¯å€‹ frame ç´°éƒ¨çš„ç‹€æ³ä¾†æ‰¾åˆ° root causeï¼Œ<a href="https://web.dev/debug-layout-shifts/">åƒè€ƒè©³ç´°å¦‚ä½• debug</a>ã€‚</p><h2>ç¸½çµ</h2><p>é€™ç¯‡æ–‡ç« å°‡æœƒè·Ÿè‘— Google åœ¨ Web Vitals ä¸Šçš„æ–°ææ¡ˆä»¥åŠç­†è€…è‡ªèº«çš„ç ”ç©¶æŒçºŒæ›´æ–°ï¼Œå¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°éƒ½æ­¡è¿èˆ‡æˆ‘è¯çµ¡ã€‚</p><h2>Reference</h2><p><a href="https://web.dev/learn-web-vitals/">Web Vitals</a></p><p><a href="https://www.youtube.com/watch?v=_o0Q-fUjeiA&amp;t=27s&amp;ab_channel=GoogleDevelopersTaiwan-Google%E9%96%8B%E7%99%BC%E4%BA%BA%E5%93%A1%E5%8F%B0%E7%81%A3%E9%A0%BB%E9%81%93">I/O Extended 2021 ç³»åˆ—: Chrome DevTools &amp; Web Vitals</a></p><p><a href="https://cythilya.github.io/2021/10/24/mopcon-speed-up-your-app-with-web-vitals/?fbclid=IwAR3GXoUWjr9GXFaYZBjR4NMfiiucoGAIOtjSG8sRg02BFg86qlFF55u6fq4">æ‰“é€ é«˜é€Ÿç¶²ç«™ï¼Œå¾ç¶²ç«™æŒ‡æ¨™é–‹å§‹ï¼(Speed Up Your App with Web Vitals) MOPCON 2021 é€å­—ç¨¿ | Summerã€‚æ¡‘è«ã€‚å¤å¤©</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Prerender.ioå¦‚ä½•å¹«åŠ©CSRçš„SEO - åŸç†ä»‹ç´¹èˆ‡ä½¿ç”¨æ•™å­¸]]></title>
            <link>https://gcdeng.com/blog/solve-seo-problems-with-prerenderio</link>
            <guid>solve-seo-problems-with-prerenderio</guid>
            <pubDate>Sun, 07 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[Client-Side Rendering (CSR) Single Page Application (SPA) æœ€å¸¸é‡åˆ°çš„å•é¡Œå°±æ˜¯ SEOï¼Œè§£æ±ºé€™å€‹å•é¡Œçš„æ–¹æ³•æœ‰å¾ˆå¤šç¨®ï¼Œå…¶ä¸­ä¸€ç¨®ç²å¾— Google æ¨è–¦çš„æ–¹æ³•æ˜¯**Prerender.io**ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒä»‹ç´¹å®ƒçš„é‹ä½œåŸç†ä»¥åŠå¦‚ä½•é–‹å§‹å°å…¥ä½¿ç”¨ã€‚]]></description>
            <content:encoded><![CDATA[<p>Client-Side Rendering (CSR) Single Page Application (SPA) æœ€å¸¸é‡åˆ°çš„å•é¡Œå°±æ˜¯ SEOï¼Œè§£æ±ºé€™å€‹å•é¡Œçš„æ–¹æ³•æœ‰å¾ˆå¤šç¨®ï¼Œå…¶ä¸­ä¸€ç¨®ç²å¾— Google æ¨è–¦çš„æ–¹æ³•æ˜¯<strong>Prerender.io</strong>ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒä»‹ç´¹å®ƒçš„é‹ä½œåŸç†ä»¥åŠå¦‚ä½•é–‹å§‹å°å…¥ä½¿ç”¨ã€‚</p><h2>é–‹å§‹ä¹‹å‰ï¼Œå…ˆèŠèŠ CSR çš„ SEO å•é¡Œ</h2><p>Client-Side Rendering (CSR) æ˜¯éå»å¹¾å¹´æµè¡Œçš„å‰ç«¯é–‹ç™¼æ–¹å¼ï¼Œç€è¦½å™¨æœƒæ”¶åˆ°ä¸€å€‹ body è£¡åªæœ‰æ ¹å…ƒä»¶ä»¥åŠå¼•å…¥æ‰“åŒ…å¥½çš„ JS çš„ HTMLï¼Œè§£æ HTML å¾Œé–‹å§‹ä¸‹è¼‰åŠåŸ·è¡Œ JS å°‡å…§å®¹æ¸²æŸ“é€²æ ¹å…ƒä»¶ä¸­ï¼Œå¤§éƒ¨åˆ†çš„é‹ç®—è³‡æºæœƒé›†ä¸­åœ¨ç€è¦½å™¨ä¸Šï¼Œè€Œæœ€å¤§çš„å•é¡Œæ˜¯æœå°‹å¼•æ“åš SEO çš„çˆ¬èŸ²ä¸¦ä¸æœƒç­‰å¾… AJAX è·Ÿ JS æ¸²æŸ“å¥½å…§å®¹æ‰é–‹å§‹è’é›†è³‡æ–™ï¼Œä»–åªæœƒçœ‹åˆ° HTML ä¸­ä¸€å€‹ç©ºç©ºçš„æ ¹å…ƒä»¶ï¼Œæ²’æœ‰è³‡æ–™å¯ä»¥çµ¦ä»–åš Indexï¼Œé›–ç„¶ Google Search å¾Œä¾†ä¹Ÿæœ‰<a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics">æ–°çš„çˆ¬èŸ²æ©Ÿåˆ¶</a>è§£æ±ºé€™å€‹å•é¡Œï¼Œä½†çˆ¬èŸ²ä¹Ÿæœ‰<a href="https://prerender.io/crawl-budget-seo/">è³‡æºé ç®—</a>(Crawl Budget)é™åˆ¶ï¼ŒCSR éœ€è¦èŠ±è²»å¤§é‡çˆ¬èŸ²é‹ç®—è³‡æºï¼Œå°è‡´ Index æœƒéœ€è¦å¾ˆå¤šæ™‚é–“ç”šè‡³æœ‰äº›é é¢ä¹Ÿç„¡æ³•åš Indexï¼Œå¦å¤–ä¸€å€‹å•é¡Œæ˜¯ç¤¾äº¤åª’é«”ä¾‹å¦‚ FB, Twitter éœ€è¦çš„<a href="https://ahrefs.com/blog/open-graph-meta-tags/">open graph meta tag</a>å¦‚æœæ˜¯ CSR å‹•æ…‹ç”¢ç”Ÿçš„è©±ä¸€é–‹å§‹ä¹Ÿæœƒæ‹¿ä¸åˆ°ï¼Œæ–¼æ˜¯é–‹å§‹æœ‰äººæå‡ºå¾ˆå¤šäº‹å…ˆæ¸²æŸ“(pre-rendering)å¥½éœæ…‹ HTML å†é€çµ¦ client çš„è§£æ³•ï¼Œä»¥ä¸‹åˆ—èˆ‰å¹¾ç¨®ï¼š</p><ol><li>Pre-build æˆ–ç¨± Static Site Generator (SSG)ï¼Œæ˜¯åœ¨ build-time æº–å‚™å¥½æ¯å€‹è·¯ç”±(Route)éœ€è¦çš„è³‡æ–™ä¸¦å»ºç«‹å‡ºå®Œæ•´çš„éœæ…‹ HTMLï¼Œserver æ”¶åˆ°è«‹æ±‚æ™‚ç›´æ¥å›å‚³å·²ç¶“å»ºç«‹å¥½çš„ HTMLï¼Œå¸¸è¦‹çš„å·¥å…·åŒ…å«<a href="https://github.com/stereobooster/react-snap">react-snap</a>ï¼Œ<a href="https://www.11ty.dev/">Eleventy</a>ï¼Œé€™å€‹æ–¹æ³•çš„å„ªé»åŒ…å«å¯ä»¥åœ¨ CDN cache HTML ç¸®çŸ­è«‹æ±‚å›å‚³æ™‚é–“ä»¥åŠ<a href="https://web.dev/fcp/">First Contentful Paint (FCP)</a>æ™‚é–“ï¼Œç¼ºé»å‰‡æ˜¯å› ç‚ºæ˜¯åœ¨ build-time ç”¢ç”Ÿ HTMLï¼Œæ¯æ¬¡æœ‰å…§å®¹è®Šå‹•éƒ½è¦é‡ buildï¼Œå°æ–¼å…§å®¹è®Šå‹•é »ç‡é«˜çš„ç¶²ç«™æœƒå¾ˆéº»ç…©ï¼Œä¹Ÿæœƒå»¶é•· build çš„æ™‚é–“ã€‚</li><li>Server-Side Rendering (SSR)ï¼Œç›¸å°æ–¼ SSG ä¾†èªªå®ƒå‰‡æ˜¯åœ¨ run-time å»ºç«‹å¥½ HTMLï¼Œç•¶ server æ”¶åˆ°æŸå€‹è·¯ç”±çš„è«‹æ±‚å¾Œé–‹å§‹æº–å‚™éœ€è¦çš„è³‡æ–™ä¸¦å»ºç«‹å¥½ HTML å›å‚³çµ¦ clientï¼Œè§£æ±ºäº† SSG çš„å•é¡ŒåŒæ™‚ç¹¼æ‰¿å…¶å„ªé»ï¼Œä½†ä¹Ÿæœ‰å®ƒæœ¬èº«çš„çš„å•é¡Œï¼Œå°±æ˜¯æœƒæå‡é–‹ç™¼è¤‡é›œåº¦ï¼Œä»¥åŠç¾æœ‰çš„ CSR å°ˆæ¡ˆé›£ä»¥è½‰æ›æˆ SSR æ¶æ§‹ï¼Œå¸¸è¦‹çš„å·¥å…·æ¡†æ¶åŒ…å« React çš„<a href="https://nextjs.org/">Next.js</a>ï¼ŒVue çš„<a href="https://nuxtjs.org/">Nuxt.js</a>ã€‚ï¼ˆä¸éé€™é¡æ¡†æ¶é‚„æ˜¯æœ‰å¾ˆå¤šå¾ˆé¦™çš„ç‰¹è‰²ï¼‰</li><li>Prerender.io</li></ol><h2>Prerender.io é‹ä½œåŸç† - Dynamic Rendering</h2><p><img src="/img/2021-11-07-solve-seo-problems-with-prerenderio-assets/prerenderio.png" alt="Screen Shot 2021-11-08 at 11.11.38 AM.png"/></p><p><a href="https://prerender.io/">Prerender.io</a>é‹ä½œæµç¨‹æ˜¯ç•¶å‰ç«¯çš„ web server æ”¶åˆ°è«‹æ±‚æ™‚é€é Prerender-node Middleware å»è¾¨è­˜é€™å€‹è«‹æ±‚æ˜¯å¾ç€è¦½å™¨é‚„æ˜¯å¾çˆ¬èŸ²ç™¼å‡ºçš„ï¼Œå¦‚æœæ˜¯ç€è¦½å™¨å°±ä¾ç…§åŸæœ¬çš„ CSR æ©Ÿåˆ¶ï¼Œå¦‚æœæ˜¯çˆ¬èŸ²æ‰éœ€è¦åš prerenderï¼Œæœƒå§”è¨— Prerender.io cloud service å¹«æˆ‘å€‘æ¸²æŸ“å‡ºéœæ…‹ HTML å†å›å‚³çµ¦ web server ç„¶å¾Œå†å›çµ¦çˆ¬èŸ²ï¼Œé€™æ¨£çš„æ¸²æŸ“æ–¹å¼ç¨±ç‚º<a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering">Dynamic Rendering</a>ã€‚</p><h3>è¾¨è­˜çˆ¬èŸ²çš„æ–¹æ³•</h3><p>åˆ©ç”¨ request header ä¸­ user-agent çš„å€¼ï¼Œå¦‚æœæ˜¯ google search çš„çˆ¬èŸ²æœƒå¸¶ä¸Š <code>googlebot</code> ï¼Œç›®å‰æ”¯æ´çš„çˆ¬èŸ²æœ‰é€™äº›ï¼š</p><pre><code class="language-jsx">prerender.crawlerUserAgents = [
  &#x27;googlebot&#x27;,
  &#x27;Yahoo! Slurp&#x27;,
  &#x27;bingbot&#x27;,
  &#x27;yandex&#x27;,
  &#x27;baiduspider&#x27;,
  &#x27;facebookexternalhit&#x27;,
  &#x27;twitterbot&#x27;,
  &#x27;rogerbot&#x27;,
  &#x27;linkedinbot&#x27;,
  &#x27;embedly&#x27;,
  &#x27;quora link preview&#x27;,
  &#x27;showyoubot&#x27;,
  &#x27;outbrain&#x27;,
  &#x27;pinterest/0.&#x27;,
  &#x27;developers.google.com/+/web/snippet&#x27;,
  &#x27;slackbot&#x27;,
  &#x27;vkShare&#x27;,
  &#x27;W3C_Validator&#x27;,
  &#x27;redditbot&#x27;,
  &#x27;Applebot&#x27;,
  &#x27;WhatsApp&#x27;,
  &#x27;flipboard&#x27;,
  &#x27;tumblr&#x27;,
  &#x27;bitlybot&#x27;,
  &#x27;SkypeUriPreview&#x27;,
  &#x27;nuzzel&#x27;,
  &#x27;Discordbot&#x27;,
  &#x27;Google Page Speed&#x27;,
  &#x27;Qwantify&#x27;,
  &#x27;pinterestbot&#x27;,
  &#x27;Bitrix link preview&#x27;,
  &#x27;XING-contenttabreceiver&#x27;,
  &#x27;Chrome-Lighthouse&#x27;,
  &#x27;TelegramBot&#x27;,
];
</code></pre><h3>çˆ¬èŸ²ç²å–éœæ…‹ HTML çš„æ–¹æ³•</h3><p>æˆ‘å€‘çš„ web server è¦å»æ‰“ Prerender.io æä¾›çš„ GET API ä¸¦å¸¶ä¸Šçˆ¬èŸ²è«‹æ±‚çš„è·¯ç”±ï¼ŒPrerender.io æœƒé–‹ä¸€å€‹<a href="https://developers.google.com/web/updates/2017/04/headless-chrome">Headless Chrome</a>å»è·Ÿæˆ‘å€‘çš„ server è«‹æ±‚è©²è·¯ç”±çš„è³‡æ–™ä¾†æ¸²æŸ“ HTMLï¼Œé€™æ®µå…¶å¯¦ç­‰åŒä½¿ç”¨ Headless Chrome åœ¨åš CSRï¼Œå†é€é HTTP åˆ†å¡Š(chunk)å‚³è¼¸å¾åŸæœ¬çš„ API å›å‚³æ¸²æŸ“å¥½çš„ HTML çµ¦æˆ‘å€‘çš„ serverï¼Œserver æ”¶åˆ°å¾Œå†æŠŠ HTML å›è¦†çµ¦çˆ¬èŸ²çš„è«‹æ±‚ï¼Œå› æ­¤çˆ¬èŸ²å°±å¯ä»¥æ”¶åˆ°æ¸²æŸ“å¥½çš„éœæ…‹ HTML è€Œä¸”ä¸åŒ…å« JS æª”æ¡ˆã€‚</p><pre><code class="language-jsx">prerender.plainResponse = function (response, callback) {
  var content = &#x27;&#x27;;

  response.on(&#x27;data&#x27;, function (chunk) {
    content += chunk;
  });
  response.on(&#x27;end&#x27;, function () {
    response.body = content;
    callback(null, response);
  });
};
</code></pre><h2>å¦‚ä½•é–‹å§‹ä½¿ç”¨</h2><h3>åœ¨ Dev ç’°å¢ƒ</h3><p>å…ˆåœ¨ local è·‘ä¸€å°<a href="https://github.com/prerender/prerender">Prerender Node Server</a>ï¼Œå‡è¨­é–‹èµ·ä¾†çš„ URL æ˜¯ <code>http://localhost:3000</code></p><pre><code class="language-bash">git clone https://github.com/prerender/prerender.git
cd prerender
npm install
node server.js
</code></pre><p>å®˜æ–¹æœ‰æä¾›å¤šç¨®èªè¨€çš„ open source server <a href="https://docs.prerender.io/article/12-middlewares">middleware</a>ï¼Œå¯ä»¥æŠŠå®ƒå®‰è£é€²æˆ‘å€‘çš„å‰ç«¯ web server ä¸­ï¼Œå¦‚æœä½ çš„ server æ˜¯ Node.js çš„è©±å¯ä»¥ç”¨<a href="https://github.com/prerender/prerender-node">prerender-node</a></p><pre><code class="language-bash">npm install prerender-node --save
</code></pre><p>å¼•å…¥ middleware</p><pre><code class="language-jsx">app.use(require(&#x27;prerender-node&#x27;));
</code></pre><p>middleware ä¸­æœƒè®€å–ç’°å¢ƒè®Šæ•¸ <code>process.env.PRERENDER_SERVICE_URL</code> æ‰€ä»¥å¯ä»¥æŠŠå®ƒè¨­ç‚º <code>http://localhost:3000</code> ï¼Œæˆ–æ˜¯ç›´æ¥è¨­å®š middleware çš„ <code>prerenderServiceUrl</code></p><pre><code class="language-jsx">const prerenderServiceUrl = &#x27;http://localhost:3000&#x27;;
app.use(
  require(&#x27;prerender-node&#x27;).set(&#x27;prerenderServiceUrl&#x27;, prerenderServiceUrl)
);
</code></pre><p>åŸ·è¡Œ curl æˆ–æ˜¯ä½¿ç”¨ browser extensionï¼Œä¾‹å¦‚<a href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=zh-TW">ModHeader</a>ï¼Œåœ¨ header ä¸­åŠ å…¥ user-agent: <code>Googlebot</code>ï¼Œå»æ‰“ä½ çš„ service æŸå€‹é é¢è·¯ç”±ï¼Œå‡è¨­ <code>https://www.example.com/</code></p><pre><code class="language-bash">curl -A Googlebot https://www.example.com/
</code></pre><p>ä½ çš„ server æ”¶åˆ°è«‹æ±‚å¾Œï¼Œmiddleware å¦‚æœåˆ¤æ–·æ˜¯çˆ¬èŸ²å°±æœƒå»æ‰“ GET <code>http://localhost:3000/https://www.example.com/</code> ï¼Œè«‹æ±‚ Prerender Node Server æ¸²æŸ“ HTMLï¼Œä¹‹å¾Œå°±å¯ä»¥æ”¶åˆ°ä¸€å€‹å®Œæ•´æ¸²æŸ“å¥½æ²’æœ‰ script tag çš„éœæ…‹ HTMLã€‚</p><h3>åœ¨ Stage ç’°å¢ƒ</h3><p>åœ¨<a href="https://prerender.io/">Prerender.io</a>å®˜ç¶²è¨»å†Šæ–°å¸³è™Ÿæ‹¿åˆ° tokenï¼Œmiddleware ä¸­æœƒè®€å–ç’°å¢ƒè®Šæ•¸ <code>process.env.PRERENDER_TOKEN</code> å¯ä»¥æŠŠä»–è¨­å®šç‚ºä½ çš„ tokenï¼Œæˆ–æ˜¯ç›´æ¥è¨­å®šä»¥ä¸‹çš„ <code>prerenderToken</code>ã€‚</p><pre><code class="language-jsx">app.use(require(&#x27;prerender-node&#x27;).set(&#x27;prerenderToken&#x27;, &#x27;YOUR_TOKEN&#x27;));
</code></pre><p>é€šå¸¸ Stage server ä¸æœƒå°å¤–å…¬é–‹ï¼Œéœ€è¦å…ˆè¨­å®šç™½åå–®å…è¨±<a href="https://docs.prerender.io/article/22-ip-addresses">Prerender.io çš„ IP</a>ï¼Œè®“ä»–å€‘çš„ cloud service å¯ä»¥æ‰“é€² Stage server è«‹æ±‚é é¢è³‡æ–™ï¼Œå†ç…§è‘—ä¸€æ¨£çš„æ–¹æ³•å¸¶è‘—çˆ¬èŸ²çš„ user-agent å»æ‰“ä½ çš„ serviceï¼Œmiddleware æœƒå» GET <code>https://service.prerender.io/https://www.example.com/</code> ï¼Œè«‹æ±‚ cloud service æ¸²æŸ“ HTMLï¼Œä¹‹å¾Œå°±å¯ä»¥çœ‹åˆ° stage ç’°å¢ƒä¸‹çš„ prerendered HTMLï¼Œåœ¨å®˜ç¶²çš„ Dashboard ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°çˆ¬èŸ²è«‹æ±‚ç´€éŒ„ä»¥åŠè¢« cache çš„é é¢ã€‚</p><p>Stage è·Ÿ Production ä¹Ÿå¯ä»¥è€ƒæ…®ä¸ç”¨ä»–å€‘çš„ cloud serviceï¼Œè€Œæ˜¯å…§éƒ¨ç¶­è­·<a href="https://github.com/prerender/prerender">Prerender Node Server</a>ï¼Œåœ¨ middleware è¨­å®šå¥½ prerenderServiceUrl æ‰“åˆ°è‡ªå·±çš„ Prerender Node Serverã€‚</p><h2>Prerender.io çš„å„ªç¼ºé»</h2><p>å„ªé»</p><ul><li>å¯¦ä½œèµ·ä¾†æ¯”å…¶ä»–è§£æ³•æ›´ç°¡å–®å¿«é€Ÿï¼Œåªè¦è¨­å®š server middlewareã€‚</li><li>ä»»ä½•ç¾æœ‰ CSR å‰ç«¯æ¡†æ¶ React, Vue, Angular éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li><li>ä»‹é¢ä¸éŒ¯çš„ Dashboardã€‚</li><li>Cloud service æœ‰ cache æ©Ÿåˆ¶ï¼Œå¯ä»¥åœ¨ dashboard ä¸Šè¨­å®š cache æ™‚é–“ï¼Œå¦‚æœæœ‰ç‰¹åˆ¥é é¢éœ€æ±‚ä¹Ÿæœ‰æä¾›å»ºç«‹è·Ÿæ¸…é™¤ cache çš„ APIã€‚</li></ul><p>ç¼ºé»</p><ul><li><a href="https://prerender.io/pricing/">é¡å¤–é›²ç«¯æœå‹™æˆæœ¬</a>æˆ–æ˜¯è‡ªå·±ç¶­é‹<a href="https://github.com/prerender/prerender">Prerender Node Server</a>æˆæœ¬ï¼Œä¸éé€™é …å°æ–¼ä»»ä½• SSR æ–¹å¼æˆ–å¤šæˆ–å°‘éƒ½æœƒæœ‰ã€‚</li></ul><h2>ç¸½çµ</h2><p>é€™ç¯‡æ–‡ç« è¬›è§£äº† CSR é‡åˆ°çš„å•é¡Œèˆ‡ SSGã€SSRã€Prerender.io ä¸‰ç¨®è§£æ±ºæ–¹æ¡ˆï¼Œé‡å° Prerender.io ä»‹ç´¹å®ƒçš„é‹ä½œåŸç† Dynamic Renderingã€middleware ä½¿ç”¨æ–¹å¼ä»¥åŠå„ªç¼ºé»æ¯”è¼ƒï¼Œæ•´é«”ä¾†èªªæˆ‘è¦ºå¾— Prerender.io æ˜¯ä»‹æ–¼ SSG èˆ‡ SSR ä¹‹é–“è§£æ±º SEO å•é¡Œçš„æŠ˜è¡·æ–¹æ¡ˆï¼Œå¦‚æœæ˜¯ä»¥ä¸‹æƒ…å¢ƒï¼š</p><ol><li>å…·æœ‰ä¸€å®šè¦æ¨¡çš„ CSR SPA å°ˆæ¡ˆè½‰æ› SSR æ¶æ§‹æˆæœ¬éé«˜</li><li>ç¶²ç«™å…§å®¹è®Šæ›´é »ç‡é«˜</li><li>åªæƒ³å„ªåŒ– SEO</li></ol><p>é€™äº›æƒ…æ³ä¸‹ Prerender.io æœƒæ˜¯å€‹å»ºè­°å¯ä»¥è€ƒæ…®çš„è§£æ³•ï¼Œé‚„æœ‰å…¶ä»–æ›´å¤šç´°ç¯€ä¹Ÿå¯ä»¥åˆ°ä»–å€‘çš„å®˜æ–¹æ–‡ä»¶çœ‹çœ‹ã€‚</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2>Reference</h2><p><a href="https://prerender.io/">Render Javascript With Search Engines in Mind | Prerender</a></p><p><a href="https://docs.prerender.io/">Prerender.io Knowledge Base</a></p><p><a href="https://github.com/prerender/prerender">https://github.com/prerender/prerender</a></p><p><a href="https://github.com/prerender/prerender-node">https://github.com/prerender/prerender-node</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering">Dynamic Rendering | Google Search Central | Google Developers</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics">Understand JavaScript SEO Basics | Google Search Central</a></p><p><a href="https://prerender.io/crawl-budget-seo/">Crawl Budget Optimization | Improve Crawl Health | Prerender</a></p><p><a href="https://developers.google.com/web/updates/2017/04/headless-chrome">Getting Started with Headless Chrome | Web | Google Developers</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[å‰ç«¯å„ªåŒ–ç³»åˆ—] ä½¿ç”¨async, deferå±¬æ€§åŠ é€Ÿç¶²é è¼‰å…¥æ™‚é–“]]></title>
            <link>https://gcdeng.com/blog/script-tag-async-defer-attributes</link>
            <guid>script-tag-async-defer-attributes</guid>
            <pubDate>Thu, 04 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[ç€è¦½å™¨åœ¨è§£æ HTML æ™‚å¦‚æœé‡åˆ°`<script>...</script>`å°±æœƒæš«åœè§£æç›´æ¥é–‹å§‹åŸ·è¡Œï¼Œå¦‚æœæ˜¯å¤–éƒ¨è³‡æº`<script src="..."></script>`æœƒç­‰å¾…ä¸‹è¼‰ä¸¦åŸ·è¡Œå®Œæˆä¹‹å¾Œæ‰é–‹å§‹ç¹¼çºŒè§£æ HTML å»ºç«‹ DOMï¼Œé€™æ¨£ç•¶é‡åˆ°å…§å®¹å¾ˆå¤šçš„ script æ™‚å°‡æœƒå»¶é•·é é¢æ¸²æŸ“çš„æ™‚é–“ï¼Œä¹Ÿæœƒè®“ä½¿ç”¨è€…æ›´æ…¢çœ‹åˆ°ç¶²é å…§å®¹å½±éŸ¿ä½¿ç”¨é«”é©—ã€‚`async`, `defer` æ­£æ˜¯ç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œè€Œç”Ÿçš„å…©å€‹ script tag å±¬æ€§ï¼Œé€™ç¯‡æ–‡ç« æœƒä»‹ç´¹ä»–å€‘çš„å…±åŒé»èˆ‡ç›¸ç•°é»ï¼Œä»¥åŠå„è‡ªé©ç”¨çš„æƒ…å¢ƒã€‚]]></description>
            <content:encoded><![CDATA[<p>ç€è¦½å™¨åœ¨è§£æ HTML æ™‚å¦‚æœé‡åˆ°<code>&lt;script&gt;...&lt;/script&gt;</code>å°±æœƒæš«åœè§£æç›´æ¥é–‹å§‹åŸ·è¡Œï¼Œå¦‚æœæ˜¯å¤–éƒ¨è³‡æº<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>æœƒç­‰å¾…ä¸‹è¼‰ä¸¦åŸ·è¡Œå®Œæˆä¹‹å¾Œæ‰é–‹å§‹ç¹¼çºŒè§£æ HTML å»ºç«‹ DOMï¼Œé€™æ¨£ç•¶é‡åˆ°å…§å®¹å¾ˆå¤šçš„ script æ™‚å°‡æœƒå»¶é•·é é¢æ¸²æŸ“çš„æ™‚é–“ï¼Œä¹Ÿæœƒè®“ä½¿ç”¨è€…æ›´æ…¢çœ‹åˆ°ç¶²é å…§å®¹å½±éŸ¿ä½¿ç”¨é«”é©—ã€‚</p><p><code>async</code>, <code>defer</code> æ­£æ˜¯ç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œè€Œç”Ÿçš„å…©å€‹ script tag å±¬æ€§ï¼Œé€™ç¯‡æ–‡ç« æœƒä»‹ç´¹ä»–å€‘çš„å…±åŒé»èˆ‡ç›¸ç•°é»ï¼Œä»¥åŠå„è‡ªé©ç”¨çš„æƒ…å¢ƒã€‚</p><p><img src="/img/2021-11-04-script-tag-async-defer-attributes-assets/script-async-defer.png" alt="script-async-defer.png"/></p><p>æ™‚åºåœ– (ä¾†æºï¼šSpeed up Google Maps(and everything else) with async &amp; defer)</p><h2>async, defer çš„å…±åŒé»</h2><ul><li>è§£æ HTML æ™‚è·‘åˆ°å°±é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ scriptï¼Œä¸‹è¼‰æ™‚ä¸é˜»æ“‹ç€è¦½å™¨è§£æ HTMLã€å»ºç«‹ DOMï¼Œå¦‚æ­¤ä¸€ä¾†é é¢æ¸²æŸ“å®Œæˆä½¿ç”¨è€…å°±å¯ä»¥å…ˆçœ‹åˆ°ç¶²é å…§å®¹ã€‚</li><li>åªå°å¾å¤–éƒ¨è¼‰å…¥çš„ script æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯æ²’æœ‰ src çš„ inline script æ²’æœ‰ä½œç”¨ï¼Œæœƒç›´æ¥é–‹å§‹åŸ·è¡Œã€‚</li></ul><h2>defer</h2><ul><li>DOM å»ºç«‹å®Œæˆä¹‹å¾Œæ‰é–‹å§‹åŸ·è¡Œ scriptã€‚</li><li>åŠ äº† defer çš„ script ä¹‹é–“æœƒç…§è‘—å¯«åœ¨ HTML çš„é †åºåŸ·è¡Œï¼Œå°±ç®—å…ˆä¸‹è¼‰å¥½äº†ä¹Ÿæœƒç­‰å‰é¢çš„åŸ·è¡Œå®Œæˆã€‚</li></ul><p>é©ç”¨æƒ…å¢ƒï¼š</p><p>ä¾è³´ DOM æˆ–å…¶ä»– scriptï¼Œä¾‹å¦‚æœƒéœ€è¦ä½¿ç”¨ HTML element æˆ–æ˜¯å…¶ä»– script çš„è³‡æ–™ï¼Œç¬¦åˆå¤§éƒ¨åˆ†çš„ä½¿ç”¨æƒ…å¢ƒï¼Œé€šå¸¸éƒ½å¯ä»¥åŠ ä¸Šé€™å€‹å±¬æ€§ï¼Œç„¶å¾ŒæŠŠ script tag æ”¾åœ¨<code>&lt;head&gt;</code>è£¡è®“ä»–ç›¡æ—©é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ï¼Œåªéœ€è¦æ³¨æ„å¯«åœ¨ HTML ä¸Šçš„åŸ·è¡Œå…ˆå¾Œé †åºã€‚</p><h2>async</h2><ul><li>ä¸ç®¡ DOM å¥½äº†æ²’ï¼Œscript ä¸‹è¼‰å¥½å°±åŸ·è¡Œï¼Œé–‹å§‹åŸ·è¡Œä¹‹å¾Œä¾ç„¶æœƒæš«åœè§£æ HTMLã€‚</li><li>åŠ äº† async çš„ script ä¹‹é–“ä¸ä¿è­‰åŸ·è¡Œé †åºï¼Œä¹Ÿä¸æœƒç­‰å¾…å…¶ä»– scriptï¼Œå…ˆä¸‹è¼‰å¥½å…ˆåŸ·è¡Œã€‚</li></ul><p>é©ç”¨æƒ…å¢ƒï¼š</p><p>æ²’æœ‰ç›¸ä¾æ€§çš„ scriptï¼Œä¸ä¾è³´ DOM æˆ–å…¶ä»– scriptï¼Œèª°å…ˆåŸ·è¡Œéƒ½æ²’é—œä¿‚ï¼Œé©ç”¨æ–¼ç¨ç«‹çš„ç¬¬ä¸‰æ–¹ script åƒ GA, GTM, ads...</p><h2>Dynamic scripts</h2><p>æœ‰æ™‚å€™å¯èƒ½æœƒå¯« js å‹•æ…‹å»ºç«‹ script tag ç„¶å¾Œæ’å…¥ HTMLï¼Œé€™æ¨£è¢«è¼‰å…¥çš„ script ç¨±ç‚º Dynamic scriptsï¼Œåƒæ˜¯é€™æ¨£ ğŸ‘‡</p><pre><code class="language-jsx">let script = document.createElement(&#x27;script&#x27;);
script.src = &#x27;/article/script-async-defer/long.js&#x27;;
document.body.append(script); // (*)
</code></pre><p>ä»¥é€™ç¨®æ–¹å¼æ’å…¥çš„ script é è¨­<code>async</code>æ•ˆæœï¼Œæ’å…¥ document ä¹‹å¾Œ<code>(*)</code>å°±é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ã€‚å¦‚æœæƒ³è¦æ”¹æˆ<code>defer</code>åªè¦è¨­å®š<code>script.async=false</code>å°±å¯ä»¥äº†ï¼ŒèƒŒæ™¯ä¸‹è¼‰å®Œæˆå¾Œæœƒç…§è‘—æ’å…¥ document çš„é †åºåŸ·è¡Œ scriptã€‚</p><h2>å¾ˆå°‘æœƒç›´æ¥æ’°å¯« HTMLï¼Œå¯¦å‹™ä¸Šæœƒæ€éº¼åšå‘¢ï¼Ÿ</h2><p>ç¾åœ¨é€šå¸¸æœƒä½¿ç”¨ webpack ä¾†æ‰“åŒ… jsï¼Œå¯ä»¥æ­é…<a href="https://github.com/jantimon/html-webpack-plugin#writing-your-own-templates">html-webpack-plugin</a>ï¼Œä»–æœƒç”Ÿæˆ HTML ä¸¦å¼•å…¥æ‰“åŒ…å¥½çš„ scriptï¼Œå¯ä»¥åœ¨ä½¿ç”¨æ™‚è¨­å®š<code>scriptLoading</code>åƒæ•¸ç‚º<code>defer</code>ã€‚</p><p>å‰©ä¸‹å…¶ä»–ç¬¬ä¸‰æ–¹çš„ script æœƒéœ€è¦ç›´æ¥å¯«åœ¨ HTML ä¸­ï¼Œé€™æ™‚å°±å¯ä»¥åŠ ä¸Š<code>acync</code>å±¬æ€§ã€‚</p><h2>ç¸½çµ</h2><p>é€™å…©å€‹å±¬æ€§è®“è¼‰å…¥é é¢æ™‚å¯ä»¥æ›´æ—©é–‹å§‹ä¸‹è¼‰ script åŒæ™‚è§£æ HTMLï¼Œç®—æ˜¯ä¸€å€‹å°å°èˆ‰æ‰‹ä¹‹å‹å°±å¯ä»¥åŠ é€Ÿç¶²é è¼‰å…¥æ™‚é–“çš„æ–¹æ³•å–”ã€‚</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2>Reference</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script">The Script element - HTML: HyperText Markup Language | MDN</a></p><p><a href="https://javascript.info/script-async-defer">Scripts: async, defer</a></p><p><a href="https://flaviocopes.com/javascript-async-defer/">Efficiently load JavaScript with defer and async</a></p><p><a href="https://medium.com/schaoss-blog/02-html-script-tag-%E5%8A%A0%E4%B8%8A-async-defer-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%8F%8A%E5%B7%AE%E7%95%B0-8205fddbbafc">å‰ç«¯ä¸‰åï½œ 02. [HTML] script tag åŠ ä¸Š async &amp; defer çš„åŠŸèƒ½åŠå·®ç•°ï¼Ÿ</a></p><p><a href="https://pjchender.dev/javascript/js-async-defer/">[JS] Async, defer attributes | PJCHENder æœªæ•´ç†ç­†è¨˜</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[è³‡å®‰ç³»åˆ—] é˜²ç¦¦CSRFæ”»æ“Šçš„äº”ç¨®æ–¹æ³•]]></title>
            <link>https://gcdeng.com/blog/five-ways-to-defend-against-CSRF-attacks</link>
            <guid>five-ways-to-defend-against-CSRF-attacks</guid>
            <pubDate>Tue, 02 Nov 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[ç¶²ç«™å‰ç«¯é˜²ç¦¦CSRFæ”»æ“Šçš„äº”ç¨®æ–¹æ³•]]></description>
            <content:encoded><![CDATA[<p><img src="/img/2021-11-02-five-ways-to-defend-against-CSRF-attacks-assets/charles-deluvio-pjAH2Ax4uWk-unsplash.jpg" alt="charles-deluvio-pjAH2Ax4uWk-unsplash.jpg"/></p><figcaption align="center">Photo by <a href="https://unsplash.com/@charlesdeluvio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Charles Deluvio</a> on <a href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></figcaption><h2>What is CSRF?</h2><p>Cross Site Request Forgery è·¨ç«™è«‹æ±‚å½é€ ï¼Œä¹Ÿè¢«ç¨±ç‚º one-click attack æˆ– session ridingï¼Œé€šå¸¸ç¸®å¯«ç‚º CSRF æˆ– XSRFã€‚</p><p>å‡è¨­æœ‰å…©å€‹ä¸åŒç¶²åŸŸ(domain)çš„ç¶²ç«™åŠä¸€ä½ä½¿ç”¨è€…</p><ul><li>A ç¶²ç«™: æƒ¡æ„ç¶²ç«™ï¼Œä¾‹å¦‚å°éŠæˆ²ç¶²ç«™</li><li>B ç¶²ç«™: æ”»æ“Šç›®æ¨™ç¶²ç«™</li><li>ä½¿ç”¨è€…ï¼šè¢«å†’å……èº«ä»½çš„å†¤å¤§é ­ï¼Œæˆ‘å€‘å°±å…ˆå«ä»–å¤§é ­å§</li></ul><p>æ”»æ“Šæµç¨‹ï¼š</p><ol><li>å¤§é ­å·²ç¶“ç™»å…¥é B ç¶²ç«™ä¸¦ä¸”ç€è¦½å™¨ cookie ä¸­åŒ…å«è­˜åˆ¥èº«ä»½çš„ auth token</li><li>é§­å®¢æƒ³è¾¦æ³•è®“å¤§é ­åœ¨ A ç¶²ç«™ä¸Šå° B ç¶²ç«™ç™¼å‡º API è«‹æ±‚ â†’ è·¨ç«™è«‹æ±‚ï¼Œè€Œä¸”é€™å€‹è«‹æ±‚å¸¶è‘— B ç¶²ç«™çš„ cookie åŠ auth tokenâ†’ å½é€ èº«ä»½</li><li>B ç¶²ç«™æ”¶åˆ°è«‹æ±‚ï¼Œç¢ºèª auth token ç¢ºå¯¦æ˜¯å¤§é ­å¾Œç¹¼çºŒåŸ·è¡Œé§­å®¢é æœŸçš„è«‹æ±‚å…§å®¹</li></ol><p>ç”¨é€™å€‹æ–¹å¼å°±å¯ä»¥è®“ä½¿ç”¨è€…ï¼ˆå¤§é ­ï¼‰åœ¨ä½¿ç”¨ A ç¶²ç«™æ™‚å¯èƒ½æ˜¯é»æ“Šä¸€å€‹æŒ‰éˆ•ç”šè‡³æ˜¯è¼‰å…¥ä¸€å¼µåœ–ç‰‡ç„¡æ„é–“å°±ä»¥è‡ªå·±çš„èº«ä»½å° B ç¶²ç«™åŸ·è¡Œæƒ¡æ„æ”»æ“Šï¼Œä¾‹å¦‚åœ¨è‡ªå·±ç™»å…¥éçš„éŠ€è¡Œç¶²ç«™è½‰å¸³ï¼Œå¦‚æœ B ç¶²ç«™ä¹Ÿæ²’å¯Ÿè¦ºå½é€ çš„è«‹æ±‚é‚£é€™å€‹æ”»æ“Šå°±æˆåŠŸäº†ã€‚</p><h2>å¦‚ä½•è§£æ±º CSRF æ”»æ“Š</h2><ol><li><p>å¾Œç«¯æœå‹™åœ¨ response header <code>Access-Control-Allow-Origin</code> æŒ‡å®šå…è¨±çš„ domainï¼Œç€è¦½å™¨æœƒå…ˆç™¼å‡º preflight è«‹æ±‚çµ¦ server æª¢æŸ¥ client domain æ˜¯å¦è¢«å…è¨±ï¼Œå¦‚æœå…è¨±çš„è©±æ‰æœƒå†ç™¼å‡ºçœŸæ­£çš„è«‹æ±‚ã€‚</p></li><li><p>ç€è¦½å™¨æœƒåœ¨ request header åŠ å…¥<code>Referer</code> åŠ<code>Origin</code> å…©å€‹æ¬„ä½ä»£è¡¨è«‹æ±‚çš„ä¾†æº domainï¼Œserver å¯ä»¥æª¢æŸ¥é€™å…©å€‹æ¬„ä½çš„å€¼æ˜¯ä¸æ˜¯å…è¨±çš„ domainï¼Œé›–ç„¶é€™å…©å€‹æ¬„ä½æ˜¯<a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name">Forbidden header name</a> ï¼Œä½†ä»æœ‰äº›<a href="https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/">å°æŠ€å·§</a>å¯ä»¥ä¿®æ”¹ï¼Œè€Œä¸”æœ‰äº›ç€è¦½å™¨å¯èƒ½æ²’æœ‰é€™å…©å€‹æ¬„ä½ï¼Œæ‰€ä»¥åªç”¨é€™å€‹æ–¹æ³•ä¸¦ä¸å®‰å…¨ã€‚</p></li><li><p>set cookie with <code>SameSite=Strict or Lax</code></p><ul><li>Strict: é€™å€‹ cookie åªæœƒè·Ÿè‘—ç›¸åŒ domain çš„è«‹æ±‚é€å‡ºï¼Œä¸æœƒè·Ÿè‘— cross site request ä¸€èµ·é€å‡ºå»</li><li>Lax: åªå…è¨±ç‰¹å®šæ–¹å¼çš„ cross site request å¯ä»¥ä¸€èµ·å¸¶è‘—é€å‡ºå»ï¼Œç‰¹å®šæ–¹å¼åŒ…å«ï¼š<code>&lt;a&gt;</code>, <code>&lt;link rel=&quot;prerender&quot;&gt;</code>, <code>&lt;form method=&quot;GET&quot;&gt;</code>ï¼ŒChrome set cookie é è¨­<code>SameSite=Lax</code></li></ul></li><li><p>CSRF token: server åŠ å¯†ç”¢ç”Ÿä¸€å€‹å”¯ä¸€ä¸”æœ‰æ™‚æ•ˆæ€§çš„ tokenï¼Œåœ¨å‰ç«¯è¼‰å…¥é é¢æ™‚æˆ–æ˜¯åœ¨å‘¼å«éœ€è¦ä¿è­·çš„ api ä¹‹å‰å…ˆè·Ÿ server å–å¾—é€™å€‹ tokenï¼Œå†æŠŠ token æ”¾é€² api request header ä¸­é€çµ¦ server æª¢æŸ¥æ˜¯åˆæ³• token æ‰æ¥å—è«‹æ±‚ã€‚</p><p>CSRF token å°±åƒæ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„é©—è­‰ç¢¼ä¾†è®“è«‹æ±‚å¤šä¸€å±¤ä¿è­·ï¼Œæ‰€ä»¥ç‰¹åˆ¥éœ€è¦æ³¨æ„å–å¾— CSRF token çš„ api ä¸èƒ½æ¥å—è·¨ç¶²åŸŸçš„è«‹æ±‚ï¼Œå¦‚æœè®“é§­å®¢æœ‰æ©Ÿæœƒå–å¾— CSRF token ä¸€æ¨£æœ‰é¢¨éšªã€‚</p><p>é€™å€‹ä¹Ÿæ˜¯æœ€å¸¸è¦‹çš„æ–¹æ³•ï¼Œå¯¦ä½œä¸Šå¯ä»¥ä½¿ç”¨å¥—ä»¶é”æˆï¼Œä¾‹å¦‚ nodejs çš„<a href="http://expressjs.com/en/resources/middleware/csurf.html">csurf</a>ã€‚</p></li><li><p>Double submit cookie: å‰ç«¯éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹ CSRF tokenï¼ŒåŒæ™‚æ”¾é€² cookie ä»¥åŠæ¯å€‹ request headerï¼Œserver æª¢æŸ¥å…©é‚Šçš„ token æ˜¯ç›¸åŒçš„æ‰æ¥å—è«‹æ±‚ï¼Œå› ç‚ºç€è¦½å™¨çš„è¨­è¨ˆé§­å®¢ç„¡æ³•å°‡å½é€ çš„ token æ”¾é€²ä½ çš„ domain çš„ cookieï¼Œæ­¤æ™‚è·¨ domain è«‹æ±‚æ‰€å¸¶çš„ cookie ä¸­ä¸€å®šæ²’æœ‰æ­£ç¢ºçš„ CSRF tokenã€‚</p></li></ol><p>é€™ç¯‡æ–‡ç« æä¾›äº† 5 å€‹é˜²ç¦¦ CSRF æ”»æ“Šçš„æ–¹æ³•ï¼Œå¯¦å‹™ä¸Šä¹Ÿè¦è€ƒæ…®å“ªäº›æ–¹æ³•é©ç”¨åœ¨ä½ çš„æœå‹™ä¸­ï¼Œå¯ä»¥å–®ç¨ä½¿ç”¨ä¹Ÿå¯ä»¥çµ„åˆä½¿ç”¨å¾—åˆ°æ›´å¥½çš„ä¿è­·ã€‚</p><p>å¦å¤–ï¼Œå°æ–¼ä½¿ç”¨è€…ä¾†èªªé¤Šæˆç™»å‡ºç¶²ç«™çš„å¥½ç¿’æ…£ä¹Ÿå¯ä»¥é™ä½é‡åˆ°çš„é¢¨éšªå–”ï¼</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2>Reference</h2><p><a href="https://medium.com/@Tommmmm/csrf-%E6%94%BB%E6%93%8A%E5%8E%9F%E7%90%86-d0f2a51810ca">CSRF æ”»æ“ŠåŸç†</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite">SameSite cookies - HTTP | MDN</a></p><p><a href="https://tech-blog.cymetrics.io/posts/jo/zerobased-cross-site-request-forgery/">é›¶åŸºç¤è³‡å®‰ç³»åˆ—ï¼ˆä¸€ï¼‰-èªè­˜ CSRFï¼ˆCross Site Request Forgeryï¼‰</a></p><p><a href="https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/">Setting the &#x27;Referer&#x27; Header Using JavaScript - TrustedSec</a></p><p><a href="https://auth0.com/blog/cross-site-request-forgery-csrf/#CSRF-Defenses-Strategies">Prevent Cross-Site Request Forgery (CSRF) Attacks</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Javascript] æ·±å…¥äº†è§£äº‹ä»¶è¿´åœˆ(Event Loop)ï¼ŒMacrotaskè·ŸMicrotaskæ˜¯ä»€éº¼ï¼Ÿ]]></title>
            <link>https://gcdeng.com/blog/javascript-deep-dive-into-event-loop</link>
            <guid>javascript-deep-dive-into-event-loop</guid>
            <pubDate>Mon, 14 Jun 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[é›–ç„¶ Javascript æ˜¯ä¸€å€‹å–®ä¸€åŸ·è¡Œç·’(Single Thread)çš„ç¨‹å¼èªè¨€ï¼ŒåŒä¸€æ™‚é–“åªèƒ½åŸ·è¡Œä¸€é …ä»»å‹™ï¼Œä½†å› ç‚ºåº•å±¤**äº‹ä»¶è¿´åœˆ(Event Loop)**é€™å€‹æ©Ÿåˆ¶è®“ä»–æœ‰èƒ½åŠ›ä»¥éåŒæ­¥çš„æ–¹å¼åŒæ™‚è™•ç†å¤šé …ä»»å‹™ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒæ·±å…¥è§£é‡‹äº‹ä»¶è¿´åœˆï¼Œå¹«åŠ©é–‹ç™¼è€…æ›´æ¸…æ¥šè‡ªå·±å¯«å‡ºçš„ç¨‹å¼ç¢¼æ˜¯å¦‚ä½•åœ¨åº•å±¤é‹ä½œã€‚]]></description>
            <content:encoded><![CDATA[<p>é›–ç„¶ Javascript æ˜¯ä¸€å€‹å–®ä¸€åŸ·è¡Œç·’(Single Thread)çš„ç¨‹å¼èªè¨€ï¼ŒåŒä¸€æ™‚é–“åªèƒ½åŸ·è¡Œä¸€é …ä»»å‹™ï¼Œä½†å› ç‚ºåº•å±¤<strong>äº‹ä»¶è¿´åœˆ(Event Loop)</strong>é€™å€‹æ©Ÿåˆ¶è®“ä»–æœ‰èƒ½åŠ›ä»¥éåŒæ­¥çš„æ–¹å¼åŒæ™‚è™•ç†å¤šé …ä»»å‹™ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒæ·±å…¥è§£é‡‹äº‹ä»¶è¿´åœˆï¼Œå¹«åŠ©é–‹ç™¼è€…æ›´æ¸…æ¥šè‡ªå·±å¯«å‡ºçš„ç¨‹å¼ç¢¼æ˜¯å¦‚ä½•åœ¨åº•å±¤é‹ä½œã€‚</p><h2>Overview</h2><p>æœ¬ç¯‡æ–‡ç« æœƒåŒ…å«ä»¥ä¸‹ä¸»é¡Œï¼Œå¾äº†è§£ Javascript çš„åŸ·è¡Œç’°å¢ƒåŠè³‡æ–™çµæ§‹åˆ°äº‹ä»¶è¿´åœˆè©³ç´°çš„é‹ä½œæµç¨‹ï¼Œä¹Ÿç®—æ˜¯æ¶µè“‹å¾åˆéšåˆ°é€²éš Javascript é–‹ç™¼è€…éƒ½å¿…é ˆçŸ¥é“çš„å…§å®¹ã€‚</p><ul><li>Javascript Engine</li><li>Memory Heap</li><li>Call Stack</li><li>Javascript Runtime</li><li>åŒæ­¥èˆ‡éåŒæ­¥</li><li>äº‹ä»¶è¿´åœˆ Event Loop</li><li>Macrotask queue vs Microtask queue</li></ul><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-event-loop.png" alt="js-event-loop.png"/>
<a href="https://suprabhasupi.hashnode.dev/how-javascript-works">https://suprabhasupi.hashnode.dev/how-javascript-works</a></p><h2>Javascript Engine</h2><p>é›»è…¦ä¸ŠçœŸæ­£åŸ·è¡Œé‹ç®—å·¥ä½œçš„æ˜¯ CPUï¼Œä½† CPU åªèƒ½ç†è§£æ©Ÿå™¨èªè¨€(Machine code)ï¼Œç„¡æ³•ç›´æ¥è®€æ‡‚ Javascript é€™ç¨®é«˜éšèªè¨€ï¼ŒJavascript Engine çš„åŠŸèƒ½å°±æ˜¯æŠŠ Javascript ç¿»è­¯æˆæ©Ÿå™¨èªè¨€ï¼Œå¦‚æ­¤ä¸€ä¾†æˆ‘å€‘å°±ä¸ç”¨ç›´æ¥æ’°å¯«å¯è®€æ€§å·®çš„æ©Ÿå™¨èªè¨€ã€‚</p><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-engine.jpeg" alt="js-engine.jpeg"/>
<a href="https://suprabhasupi.hashnode.dev/how-javascript-works">https://suprabhasupi.hashnode.dev/how-javascript-works</a></p><p>Engine è£¡åŒ…å«å¾ˆå¤šæ¨¡çµ„ï¼Œæœ¬ç¯‡æ–‡ç« åªæœƒä»‹ç´¹å…¶ä¸­çš„ Interpreter, Compiler, Memory Heap ä»¥åŠ Call Stackã€‚</p><p>Engine æœƒé€éå…©å€‹æ­¥é©Ÿç¿»è­¯ Javascriptï¼Œç¬¬ä¸€å€‹æ˜¯ Interpreter æœƒå…ˆå°‡ js è½‰æˆ Bytecodeï¼Œç¬¬äºŒå€‹æ˜¯ Compiler æœƒå°‡ Bytecode è½‰æˆ Machine Code åŒæ™‚ Profiler æœƒä¸€èµ·é€²è¡Œå„ªåŒ–ã€‚</p><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/4PqiR6V.png" alt="4PqiR6V.png"/></p><p>æœ€å¸¸è½è¦‹çš„ V8 Engine æ˜¯ç”± Google é–‹ç™¼ï¼Œè¢«ä½¿ç”¨åœ¨ Chrome ä»¥åŠ Node.js ä¸Šï¼Œä½†å…¶å¯¦é‚„æœ‰<a href="https://www.wikiwand.com/en/List_of_ECMAScript_engines">å…¶ä»–å¾ˆå¤š Engine</a>ï¼Œåªè¦ç¬¦åˆ ECMAScript åˆ¶å®šçš„æ¨™æº–å¤§å®¶éƒ½å¯ä»¥é–‹ç™¼è‡ªå·±çš„ Javascript Engine.</p><h2>Memory Heap</h2><p>ä¸»è¦æœ‰ä»¥ä¸‹åŠŸèƒ½:</p><ol><li>åˆ†é…è¨˜æ†¶é«”ç©ºé–“çµ¦è®Šæ•¸ä½¿ç”¨ï¼Œåˆ†é…å¥½ä¹‹å¾Œæœƒå¾—åˆ°ä¸€å€‹ä½å€</li><li>å°‡è®Šæ•¸çš„å€¼å¯«é€²é…ç½®å¥½çš„è¨˜æ†¶é«”ç©ºé–“</li><li>ä½¿ç”¨ä½å€å¾è¨˜æ†¶é«”ç©ºé–“è®€å–è®Šæ•¸çš„å€¼</li><li>é‡‹æ”¾ä¸å†ä½¿ç”¨çš„è¨˜æ†¶é«”ç©ºé–“(Garbage Collection)</li></ol><p>èˆ‰ä¾‹ä¾†èªªï¼ŒMemory Heap å°±åƒæ˜¯ä¸€å€‹æŠ½å±œæ«ƒï¼Œæ¯å€‹æœ‰æ”¾æ±è¥¿çš„æŠ½å±œéƒ½æœƒæœ‰ä¸€å€‹ç·¨è™Ÿï¼Œç¨‹å¼æœƒç”¨é€™å€‹ç·¨è™Ÿå»æ‰¾æ±è¥¿ã€‚</p><p>æŠ½å±œæ«ƒ â†’Memory Heap</p><p>æŠ½å±œ â†’ è¨˜æ†¶é«”ç©ºé–“</p><p>æ±è¥¿ â†’ è®Šæ•¸çš„å€¼</p><p>ç·¨è™Ÿ â†’ è¨˜æ†¶é«”ä½å€(reference)</p><h2>Call Stack</h2><p>Stack æ˜¯ä¸€å€‹å…ˆé€²å¾Œå‡º(FILO, First In Last Out)é¡ä¼¼ç½å­çš„çµæ§‹ï¼Œç•¶ç¨‹å¼å‘¼å«å‡½å¼(Call function)æ™‚æœƒæŠŠå‡½å¼æ”¾é€² stack ä¸­ï¼Œç›´åˆ°å‡½å¼åŸ·è¡ŒçµæŸ return å¾Œå†å°‡å‡½å¼å¾ stack ä¸­å–å‡ºã€‚</p><p>Call Stack çš„æœ€åº•å±¤ä¸€å®šæœƒæœ‰ä¸€å€‹<strong><a href="https://medium.com/itsems-frontend/javascript-execution-context-and-call-stack-e36e7f77152e">Global Execution Context</a></strong>ï¼Œæä¾›å…¶ä»–å‡½å¼å­˜å– global object ä»¥åŠ<code>this</code>é—œéµå­—ã€‚</p><p>å› ç‚º Javascript åªæœ‰ä¸€å€‹ Call Stack ç¨‹å¼ä¸­æ‰€æœ‰çš„ä»»å‹™éƒ½æœƒåœ¨é€™å€‹ Stack ä¸­åŸ·è¡Œï¼Œæ‰€ä»¥è¢«ç¨±ç‚º Single Threadï¼Œé€™å€‹è¨­è¨ˆè®“ä»–åŒä¸€æ™‚é–“åªæœ‰è¾¦æ³•åŸ·è¡Œä¸€ä»¶ä»»å‹™ï¼Œç„¡æ³•åŒæ™‚åŸ·è¡Œå¤šä»¶ä»»å‹™ï¼Œä¹Ÿå°±æ˜¯æ‰€è¬‚çš„ Synchronousã€‚</p><p>Javascript é›–ç„¶åªæœ‰ä¸€å€‹ Engine åœ¨åŸ·è¡Œä»»å‹™ï¼Œä½†é€šå¸¸èƒŒå¾Œé‚„æœ‰ Runtime åœ¨éåŒæ­¥çš„åŸ·è¡Œä»»å‹™ã€‚</p><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-call-stack.png" alt="js-call-stack.png"/>
<a href="https://suprabhasupi.hashnode.dev/how-javascript-works">https://suprabhasupi.hashnode.dev/how-javascript-works</a></p><h2>Javascript Runtime</h2><p>Runtime æŒ‡çš„æ˜¯åœ¨åŸ·è¡Œæ™‚æœŸæä¾› Global Object çµ¦ JS Engine è®“å®ƒæœ‰èƒ½åŠ›èˆ‡åŸ·è¡Œç’°å¢ƒäº’å‹•ã€‚</p><p>åœ¨ Browser ç’°å¢ƒä¸­ Runtime å°±æ˜¯ Web APIsï¼ŒJS Engine å¯ä»¥é€é<code>window</code> object ä¾†ä½¿ç”¨ Web APIsï¼Œé€é Web APIs åŸ·è¡ŒéåŒæ­¥çš„ä»»å‹™ï¼Œä¾‹å¦‚æ“ä½œ DOM, AJAX, setTimeout ç­‰ã€‚</p><p>åœ¨ Node.js ç’°å¢ƒä¸­ Runtime å°±æ˜¯ Global APIsï¼ŒJS Engine å¯ä»¥é€é<code>global</code> object ä¾†ä½¿ç”¨å„ç¨® built-in APIï¼Œä¾‹å¦‚ Buffer, process, require ç­‰ã€‚</p><h2>è©³ç´°è§£é‡‹åŒæ­¥èˆ‡éåŒæ­¥</h2><p>åŒæ­¥(Synchronous)æŒ‡çš„æ˜¯ç¨‹å¼ç¢¼çš„åŸ·è¡Œé †åºæ˜¯ç”±ä¸Šå¾€ä¸‹ä¸€è¡Œä¸€è¡Œçš„åŸ·è¡Œï¼ŒåŒä¸€æ™‚é–“åªèƒ½åšä¸€ä»¶äº‹ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€è¡Œçš„ç¨‹å¼å¦‚æœæ²’æœ‰åŸ·è¡Œå®Œå°±æœƒå¡ä½ä¸‹ä¸€è¡Œç¨‹å¼çš„åŸ·è¡Œé€ æˆé˜»å¡(blocking)ï¼Œå°è‡´å¾Œé¢çš„ç¨‹å¼éƒ½ç„¡æ³•åŸ·è¡Œï¼Œå¦‚æœé‡åˆ°è¤‡é›œçš„æ•¸å­¸é‹ç®—æˆ–æ˜¯éœ€è¦å¤§é‡ CPU é‹ç®—çš„ä»»å‹™æ™‚å°±æœƒåš´é‡å½±éŸ¿ç¨‹å¼çš„é‹ä½œã€‚</p><p>éåŒæ­¥(Asynchronous)æŒ‡çš„æ˜¯æœƒå…ˆå°‡å·¥ä½œä¸Ÿå‡ºå»çµ¦å…¶ä»–åŸ·è¡Œç’°å¢ƒ(Runtime)è™•ç†ï¼Œä¸é˜»å¡(non-blocking)å¾ŒçºŒç¨‹å¼çš„åŸ·è¡Œï¼Œè™•ç†å®Œæˆå¾Œå†å°‡çµæœå‚³çµ¦å›èª¿å‡½å¼(callback function)ï¼Œç„¶å¾Œç­‰å¾… Event Loopï¼Œä¾‹å¦‚ AJAX æˆ–æ˜¯è®€æª”å¯«æª”é€™ç¨®å­˜å–å¤–éƒ¨è³‡æ–™çš„ I/O éƒ½æ˜¯å¸¸è¦‹çš„éåŒæ­¥è¡Œç‚ºã€‚</p><h2>äº‹ä»¶è¿´åœˆ Event Loop çš„é‹ä½œæµç¨‹</h2><p>äº†è§£äº†ä»¥ä¸Šæ¨¡çµ„ä¹‹å¾Œï¼ŒEvent Loop ä¹Ÿæœƒå¾ˆå¥½ç†è§£ï¼Œå…¶å¯¦å°±æ˜¯é€™äº›æ¨¡çµ„ä¸€èµ·äº’å‹•ä¹‹ä¸‹å½¢æˆçš„ç„¡é™è¿´åœˆï¼Œè¿´åœˆæµç¨‹å¦‚ä¸‹</p><ol><li>Javascript engine åŸ·è¡Œ call stack ä¸­çš„ä»»å‹™ã€‚</li><li>ç•¶é‡åˆ° Web APIs æˆ–æ˜¯ç„¡æ³•è™•ç†çš„ä»»å‹™æ™‚æœƒäº¤çµ¦ Javascript runtime åŸ·è¡Œï¼ŒJavascript runtime è™•ç†å®Œæˆå¾Œæœƒå°‡è³‡æ–™äº¤çµ¦ callback functionï¼Œä¸¦å°‡ callback function æ”¾é€² queue ä¸­ï¼Œå½¢æˆ Callback Queueã€‚</li><li>Javascript runtime ç­‰å¾… call stack ä¸­çš„ä»»å‹™å…¨éƒ¨åŸ·è¡ŒçµæŸè®Šæˆç©ºçš„ï¼Œå¾ callback queue ä¸­æ‹‰å–ç¬¬ä¸€å€‹ä»»å‹™æ”¾é€² call stackï¼Œå›åˆ°ç¬¬ä¸€æ­¥ç¹¼çºŒé‡è¤‡å¾ªç’°ä¸‹å»ã€‚</li></ol><p>å¯ä»¥åƒè€ƒé€™å€‹å½±ç‰‡</p><iframe width="560" height="315" src="https://www.youtube.com/embed/N0Au8yc5IOw" title="YouTube video player" frameBorder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><h2>ç´°è«‡ Callback Queue</h2><p>ä¸Šé¢èªªåˆ°çš„ Callback Queue æ˜¯å­˜æ”¾ callback function åœ°æ–¹ï¼Œä¹Ÿæœ‰å¾ˆå¤šåˆ¥åä¾‹å¦‚ Event Queue, Task Queueã€‚</p><p>é€šå¸¸å¤§éƒ¨åˆ†çš„æ–‡ç« éƒ½åªæœƒèªªåˆ° Callback Queue å°±çµæŸäº†ï¼Œä½†å¯¦éš›ä¸Šä»–åˆå¯ä»¥è¢«ç´°åˆ†ç‚º Macrotask Queue ä»¥åŠ Microtask Queueï¼Œå·®åˆ¥åœ¨æ–¼ queue ä¸­å­˜æ”¾çš„ä»»å‹™æœ‰æ‰€ä¸åŒã€‚</p><h2>Macrotask Queue</h2><p>macrotask åŒ…å«ï¼š</p><ul><li>å¾ <code>&lt;script src=&quot;...&quot;&gt;</code> å¤–éƒ¨ä¸‹è¼‰çš„ script</li><li>DOM event handlersï¼Œä¾‹å¦‚ mousemove event çš„ callback function handler</li><li>å„ç¨® Web APIsï¼Œä¾‹å¦‚ setTimeout çš„ callback function</li><li>ajax callback function</li></ul><p>macrotask åœ¨åŸ·è¡Œæ™‚ç€è¦½å™¨ä¸æœƒæ¸²æŸ“(render)DOMï¼Œç€è¦½å™¨æœƒè¢«é˜»å¡ä½ï¼Œä¹Ÿå°±æ˜¯åªåŸ·è¡Œ macrotask ä¸æœƒåšå…¶ä»–äº‹æƒ…ï¼Œæœ‰æ™‚æˆ‘å€‘æœƒçœ‹åˆ°ç€è¦½å™¨è·³å‡ºé é¢æ²’æœ‰å›æ‡‰çš„è­¦å‘Šï¼Œå¯èƒ½å°±æ˜¯å› ç‚º macrotask æœ‰è¤‡é›œé‹ç®—(CPU-hungry tasks)æˆ–æ˜¯ç¨‹å¼é‚è¼¯éŒ¯èª¤å°è‡´ç„¡é™è¿´åœˆç™¼ç”Ÿï¼Œä½¿å¾—å…¶ä»–ä»»å‹™ç„¡æ³•è¢«è™•ç†ã€‚</p><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-16_at_10.37.11_PM.png" alt="Screen_Shot_2021-05-16_at_10.37.11_PM.png"/>
<a href="https://javascript.info/event-loop">https://javascript.info/event-loop</a></p><h2>Microtask Queue</h2><p>microtask åŒ…å«:</p><ul><li>promise <code>.then/catch/finally</code> ä¸­çš„ callback function</li><li><code>queueMicrotask(func)</code> ä¸­çš„ func</li></ul><p>æ¯å€‹ macrotask åŸ·è¡ŒçµæŸå¾Œæœƒå…ˆå°‡ microtask queue ä¸­çš„ task å…¨éƒ¨åŸ·è¡Œå®Œï¼Œæ‰æœƒç¹¼çºŒåŸ·è¡Œç€è¦½å™¨æ¸²æŸ“è·Ÿå…¶ä»– macrotaskã€‚</p><p>å°‡ callback queue åˆ†è§£æˆ macrotask ä»¥åŠ microtask ä¹‹å¾Œï¼Œä»–å€‘åœ¨ Event Loop ä¸­è©³ç´°çš„é‹ä½œæµç¨‹æœƒæ˜¯é€™æ¨£ï¼š</p><ol><li>å¾ macrotask queue ä¸­æ‹¿å‡ºä¸€å€‹ macrotask ä¸Ÿåˆ° call stack ä¸­åŸ·è¡Œã€‚</li><li>å°‡ microtask queue ä¸­å…¨éƒ¨çš„ task ä¾ç…§é †åº Dequeue åˆ° call stack ä¸­åŸ·è¡Œã€‚</li><li>Browser render DOMã€‚</li><li>å¦‚æœ macrotask queue æ˜¯ç©ºçš„ï¼Œsleep ç›´åˆ° macrotask å†æ¬¡å‡ºç¾ã€‚</li><li>å›åˆ°æ­¥é©Ÿ 1ã€‚</li></ol><p><img src="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-17_at_12.55.38_AM.png" alt="/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-17_at_12.55.38_AM.png"/><br/>
<a href="https://javascript.info/event-loop">https://javascript.info/event-loop</a></p><h2>Test</h2><pre><code class="language-javascript">setTimeout(() =&gt; alert(&#x27;timeout&#x27;));

Promise.resolve().then(() =&gt; alert(&#x27;promise&#x27;));

alert(&#x27;code&#x27;);
</code></pre><p>å¯ä»¥å…ˆæƒ³æƒ³è¼¸å‡ºçµæœï¼Œå†è²¼åˆ° console ä¸­åŸ·è¡Œçœ‹ç­”æ¡ˆæ˜¯ä¸æ˜¯è·Ÿè‡ªå·±æƒ³çš„ä¸€æ¨£ï¼Œå¦‚æœä¸€æ¨£çš„è©±ä»£è¡¨ä½ å·²ç¶“äº†è§£äº‹ä»¶è¿´åœˆå›‰ï¼</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°éƒ½éå¸¸æ­¡è¿ç•™è¨€è¨è«–ï¼Œè¬è¬ï¼</p><h2>Reference</h2><p><a href="https://javascript.info/event-loop">https://javascript.info/event-loop</a></p><p><a href="https://javascript.info/microtask-queue">https://javascript.info/microtask-queue</a></p><p><a href="https://suprabhasupi.hashnode.dev/how-javascript-works">https://suprabhasupi.hashnode.dev/how-javascript-works</a></p><p><a href="https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html">https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html</a></p><p><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ&amp;ab_channel=JSConf">https://www.youtube.com/watch?v=8aGhZQkoFbQ&amp;ab_channel=JSConf</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management</a></p><p><a href="https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html">https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html</a></p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[[Javascript] Mutable vs Immutable Objects]]></title>
            <link>https://gcdeng.com/blog/javascript-mutable-vs-immutable-objects</link>
            <guid>javascript-mutable-vs-immutable-objects</guid>
            <pubDate>Sun, 22 Nov 2020 00:00:00 GMT</pubDate>
            <description><![CDATA[ä»‹ç´¹ JavaScript çš„é‡è¦è§€å¿µ **Mutable åŠ Immutable Objects**ï¼Œä¸¦ä»¥ç¯„ä¾‹è§£é‡‹ä»–å€‘çš„å·®åˆ¥ã€‚]]></description>
            <content:encoded><![CDATA[<p>ä»‹ç´¹ JavaScript çš„é‡è¦è§€å¿µ <strong>Mutable åŠ Immutable Objects</strong>ï¼Œä¸¦ä»¥ç¯„ä¾‹è§£é‡‹ä»–å€‘çš„å·®åˆ¥ã€‚</p><h2>Immutable object</h2><ul><li>æ‰€æœ‰çš„<a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive">åŸå§‹è³‡æ–™å‹æ…‹(primitive)</a>ï¼ŒåŒ…å« null, undefined, string, number, boolean, symbol, bigintï¼Œéƒ½æ˜¯ immutableã€‚</li><li>immutable object æ˜¯é€é call by value çš„æ–¹å¼ï¼ŒæœƒæŒ‡å‘æ–°åˆ†é…çš„è¨˜æ†¶é«”ä½ç½®å†å­˜å…¥å€¼ï¼Œå› æ­¤ object åœ¨å»ºç«‹ä¹‹å¾Œå°±ä¸å¯å†è¢«æ”¹è®Šã€‚</li><li>ç•¶é‡æ–°è³¦å€¼æ™‚ï¼ŒæœƒæŒ‡å‘æ–°åˆ†é…çš„è¨˜æ†¶é«”ä½ç½®ï¼Œè€Œéç›´æ¥æ”¹è®Šè¨˜æ†¶é«”è£¡çš„å€¼ï¼ŒåŸæœ¬çš„è¨˜æ†¶é«”ä½ç½®æœƒè¢« garbage collectionï¼Œæ›å¥è©±èªªä»–æ˜¯è¢«å–ä»£è€Œä¸æ˜¯ç›´æ¥è¢«ä¿®æ”¹ã€‚</li></ul><h3>example 1</h3><pre><code class="language-js">let a = 1; // å»ºç«‹ä¸€å€‹immutable object a
let b = a; // å‰µå»ºä¸€å€‹æ–°çš„è¨˜æ†¶é«”ä½ç½®ï¼Œcall by value açš„å€¼å­˜å…¥1ï¼ŒbæŒ‡å‘é€™å€‹æ–°çš„ä½ç½®
b = a + 1; // å‰µå»ºä¸€å€‹æ–°çš„è¨˜æ†¶é«”ä½ç½®ï¼Œcall by value açš„å€¼å­˜å…¥1+1=2ï¼ŒbæŒ‡å‘é€™å€‹æ–°çš„ä½ç½®ï¼Œå› æ­¤aä¸æœƒè¢«+1
console.log(a, b); // 1 2 -&gt; å› ç‚ºæ˜¯ä¸åŒçš„è¨˜æ†¶é«”ä½ç½®ï¼Œæ”¹è®Šbä¹Ÿä¸æœƒå½±éŸ¿åˆ°a
a = 3; // aæŒ‡å‘æ–°åˆ†é…çš„è¨˜æ†¶é«”ä½ç½®è£¡é¢å­˜æ”¾3ï¼ŒåŸå…ˆå­˜æ”¾1çš„è¨˜æ†¶é«”ä½ç½®å‰‡æœƒè¢«åƒåœ¾å›æ”¶
</code></pre><h3>example 2</h3><pre><code class="language-js">function swap(a, b) {
  let temp = a;
  a = b;
  b = temp;
}

let x = 10;
let y = 20;
swap(x, y);
console.log(x, y); // 10 20 -&gt; a bæ˜¯call by valueï¼Œå› æ­¤äº¤æ›ä¸¦ä¸æœƒå½±éŸ¿åˆ°å‚³å…¥çš„x y
</code></pre><h2>Mutable object</h2><ul><li>é™¤äº† primitive ä¹‹å¤–çš„ object, array éƒ½æ˜¯ mutableã€‚</li><li>mutable object æ˜¯é€é call by sharing çš„æ–¹å¼ï¼Œå…±äº«åŒä¸€å€‹è¨˜æ†¶é«”ä½ç½®ï¼Œå› æ­¤ object å»ºç«‹ä¹‹å¾Œå¯å†è¢«æ”¹è®Šã€‚</li><li>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç•¶é‡æ–°è³¦å€¼æ™‚ï¼Œä»æœƒæŒ‡å‘æ–°åˆ†é…çš„è¨˜æ†¶é«”ä½ç½®ï¼ŒçµæŸåŸæœ¬çš„è¨˜æ†¶é«”å…±äº«ï¼Œå› æ­¤åŸæœ¬çš„ object ä¸æœƒè¢«æ”¹è®Šã€‚</li></ul><h3>example 1</h3><pre><code class="language-js">let a = { number: 0 }; // å»ºç«‹ä¸€å€‹mutable object a
let b = a; // call by sharingï¼Œbèˆ‡aå…±äº«è¨˜æ†¶é«”ä½ç½®
b.number++;
console.log(b); // {number: 1}
console.log(a); // {number: 1} -&gt; æ”¹è®Šbçš„åŒæ™‚aä¹Ÿè¢«æ”¹è®Šäº†
b = { age: 27 }; // å°bé‡æ–°è³¦å€¼ï¼ŒbæŒ‡å‘æ–°çš„è¨˜æ†¶é«”ä½ç½®ï¼ŒçµæŸèˆ‡aå…±äº«è¨˜æ†¶é«”ä½ç½®
console.log(a); // {number: 1} -&gt; aä¸æœƒè¢«æ”¹è®Š
</code></pre><h3>example 2</h3><pre><code class="language-js">function add(obj) {
  obj.number++;
}

let o = { number: 10 };
add(o);
console.log(o.number); // 11 -&gt; oèˆ‡objå…±äº«è¨˜æ†¶é«”ä½ç½®ï¼Œå› æ­¤æ”¹è®Šobjçš„åƒæ•¸ä¹ŸåŒæ™‚æœƒæ”¹è®Šoçš„åƒæ•¸

function add(obj) {
  obj = {
    number: obj.number + 1,
  }; // å°objé‡æ–°è³¦å€¼ï¼ŒobjæŒ‡å‘æ–°çš„è¨˜æ†¶é«”ä½ç½®ï¼ŒçµæŸèˆ‡oå…±äº«è¨˜æ†¶é«”ä½ç½®
}

let o = { number: 10 };
add(o);
console.log(o.number); // 10 -&gt; oç¶­æŒä¸€æ¨£çš„å€¼
</code></pre><h2>Reference</h2><p><a href="https://developer.mozilla.org/en-US/docs/Glossary/Mutable">https://developer.mozilla.org/en-US/docs/Glossary/Mutable</a>
<a href="https://blog.techbridge.cc/2018/06/23/javascript-call-by-value-or-reference/">https://blog.techbridge.cc/2018/06/23/javascript-call-by-value-or-reference/</a></p>]]></content:encoded>
        </item>
    </channel>
</rss>