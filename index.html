<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Eric Deng Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Eric Deng Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YZ68LNP0FW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-YZ68LNP0FW",{anonymize_ip:!0})</script><title data-react-helmet="true">Eric Deng - Eric Deng</title><meta data-react-helmet="true" property="og:title" content="Eric Deng - Eric Deng"><meta data-react-helmet="true" name="description" content="Personal blog by Eric Deng"><meta data-react-helmet="true" property="og:description" content="Personal blog by Eric Deng"><meta data-react-helmet="true" property="og:url" content="https://gcdeng.com/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><meta data-react-helmet="true" name="keywords" content="javascript,mutable,immutable"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://gcdeng.com/"><link data-react-helmet="true" rel="alternate" href="https://gcdeng.com/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://gcdeng.com/" hreflang="x-default"><script data-react-helmet="true">function maybeInsertBanner(){window.__DOCUSAURUS_INSERT_BASEURL_BANNER&&insertBanner()}function insertBanner(){var n=document.getElementById("docusaurus-base-url-issue-banner-container");if(n){n.innerHTML='\n<div id="docusaurus-base-url-issue-banner" style="border: thick solid red; background-color: rgb(255, 230, 179); margin: 20px; padding: 20px; font-size: 20px;">\n   <p style="font-weight: bold; font-size: 30px;">Your Docusaurus site did not load properly.</p>\n   <p>A very common reason is a wrong site <a href="https://docusaurus.io/docs/docusaurus.config.js/#baseurl" style="font-weight: bold;">baseUrl configuration</a>.</p>\n   <p>Current configured baseUrl = <span style="font-weight: bold; color: red;">/</span>  (default value)</p>\n   <p>We suggest trying baseUrl = <span id="docusaurus-base-url-issue-banner-suggestion-container" style="font-weight: bold; color: green;"></span></p>\n</div>\n';var e=document.getElementById("docusaurus-base-url-issue-banner-suggestion-container"),s=window.location.pathname,r="/"===s.substr(-1)?s:s+"/";e.innerHTML=r}}window.__DOCUSAURUS_INSERT_BASEURL_BANNER=!0,document.addEventListener("DOMContentLoaded",maybeInsertBanner)</script><link rel="stylesheet" href="/assets/css/styles.f14cd0ec.css">
<link rel="preload" href="/assets/js/runtime~main.602d08e5.js" as="script">
<link rel="preload" href="/assets/js/main.bf8d4acf.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div id="docusaurus-base-url-issue-banner-container"></div><div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Eric Deng</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/resume">Resume</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gcdeng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.linkedin.com/in/gcdeng/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Eric Deng</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/resume">Resume</a></li><li class="menu__list-item"><a href="https://github.com/gcdeng" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://www.linkedin.com/in/gcdeng/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-list-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/a-guidebook-to-optimize-web-vitals">[å‰ç«¯å„ªåŒ–ç³»åˆ—]Web Vitalså„ªåŒ–æ–¹æ³•æ‡¶äººåŒ…</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/solve-seo-problems-with-prerenderio">Prerender.ioå¦‚ä½•å¹«åŠ©CSRçš„SEO - åŸç†ä»‹ç´¹èˆ‡ä½¿ç”¨æ•™å­¸</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/script-tag-async-defer-attributes">[å‰ç«¯å„ªåŒ–ç³»åˆ—] ä½¿ç”¨async, deferå±¬æ€§åŠ é€Ÿç¶²é è¼‰å…¥æ™‚é–“</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/five-ways-to-defend-against-CSRF-attacks">[è³‡å®‰ç³»åˆ—] é˜²ç¦¦CSRFæ”»æ“Šçš„äº”ç¨®æ–¹æ³•</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/javascript-deep-dive-into-event-loop">[Javascript] æ·±å…¥äº†è§£äº‹ä»¶è¿´åœˆ(Event Loop)ï¼ŒMacrotaskè·ŸMicrotaskæ˜¯ä»€éº¼ï¼Ÿ</a></li></ul></nav></aside><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/a-guidebook-to-optimize-web-vitals">[å‰ç«¯å„ªåŒ–ç³»åˆ—]Web Vitalså„ªåŒ–æ–¹æ³•æ‡¶äººåŒ…</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-14T00:00:00.000Z">November 14, 2021</time> Â· 4 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>é€™ç¯‡æ–‡ç« ä»‹ç´¹äº† Web Vitalsã€æ¸¬é‡æ–¹å¼ä»¥åŠå„ªåŒ–æ–¹æ³•ï¼Œå…¶ä¸­å„ªåŒ–æ–¹æ³•æœƒéš¨è‘—è‡ªå·±çš„å¯¦å‹™ç¶“é©—åŠç ”ç©¶æŒçºŒæ›´æ–°ï¼Œå¸Œæœ›å¯ä»¥æˆç‚ºå„ªåŒ–æ•ˆèƒ½ç”¨çš„æ‡¶äººåŒ…ï¼Œåœ¨é–‹ç™¼åŠŸèƒ½æ™‚ä½œç‚ºæé†’è‡ªå·±æœƒå½±éŸ¿æ•ˆèƒ½çš„æ³¨æ„äº‹é …ï¼Œè¦å„ªåŒ–ç¶²ç«™æ™‚ä¹Ÿæ–¹ä¾¿å›ä¾†æ‰¾å¯¦ä½œçš„æ–¹å‘ã€‚</p><p><img alt="kate-stone-matheson-uy5t-CJuIK4-unsplash.jpg" src="/assets/images/kate-stone-matheson-uy5t-CJuIK4-unsplash-1e16fdb72a2aa4d88f05b08f360d19ad.jpg">Photo by Kate Stone Matheson on Unsplash</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç›®éŒ„"></a>ç›®éŒ„<a class="hash-link" href="#ç›®éŒ„" title="Direct link to heading">#</a></h2><ul><li><a href="#%E4%BB%80%E9%BA%BC%E6%98%AF-web-vitals">ä»€éº¼æ˜¯ Web Vitals?</a></li><li><a href="#%E5%A6%82%E4%BD%95%E6%B8%AC%E9%87%8F%E7%B6%B2%E7%AB%99%E7%9A%84-web-vitals%EF%BC%9F">å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„ Web Vitalsï¼Ÿ</a><ul><li><a href="#%E5%AF%A6%E9%A9%97%E6%A8%A1%E6%93%AC%E6%B8%AC%E9%87%8Fin-the-lab">å¯¦é©—æ¨¡æ“¬æ¸¬é‡(In the lab)</a></li><li><a href="#%E5%AF%A6%E6%B8%ACin-the-field">å¯¦æ¸¬(In the field)</a></li><li><a href="#%E5%A6%82%E4%BD%95%E5%B0%87%E6%B8%AC%E9%87%8F%E5%B7%A5%E5%85%B7%E5%B0%8E%E5%85%A5%E7%94%A2%E5%93%81%E9%96%8B%E7%99%BC%E6%B5%81%E7%A8%8B%E4%B8%AD">å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­</a></li></ul></li><li><a href="#%E8%BC%89%E5%85%A5%E9%80%9F%E5%BA%A6loading-performance">è¼‰å…¥é€Ÿåº¦(Loading Performance)</a><ul><li><a href="#largest-contentful-paint-lcp">Largest Contentful Paint (LCP)</a></li><li><a href="#first-contentful-paint-fcp">First Contentful Paint (FCP)</a></li><li><a href="#time-to-first-byte-ttfb">Time to First Byte (TTFB)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E4%BA%92%E5%8B%95%E5%8F%8D%E6%87%89%E8%83%BD%E5%8A%9Binteractivity">äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)</a><ul><li><a href="#first-input-delay-fid">First Input Delay (FID)</a></li><li><a href="#time-to-interactive-tti">Time to Interactive (TTI)</a></li><li><a href="#total-blocking-time-tbt">Total Blocking Time (TBT)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95-1">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E8%A6%96%E8%A6%BA%E7%A9%A9%E5%AE%9A%E6%80%A7visual-stability">è¦–è¦ºç©©å®šæ€§(Visual Stability)</a><ul><li><a href="#cumulative-layout-shift-cls">Cumulative Layout Shift (CLS)</a></li><li><a href="#speed-index-si">Speed Index (SI)</a></li><li><a href="#%E5%84%AA%E5%8C%96%E6%96%B9%E6%B3%95-2">å„ªåŒ–æ–¹æ³•</a></li></ul></li><li><a href="#%E7%B8%BD%E7%B5%90">ç¸½çµ</a></li><li><a href="#reference">Reference</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ä»€éº¼æ˜¯-web-vitals"></a>ä»€éº¼æ˜¯ Web Vitals?<a class="hash-link" href="#ä»€éº¼æ˜¯-web-vitals" title="Direct link to heading">#</a></h2><p><strong>Web Vitals</strong>æ˜¯ç”± Google æå‡ºè¡¡é‡ç¶²ç«™æ•ˆèƒ½åŠä½¿ç”¨é«”é©—çš„é‡åŒ–æŒ‡æ¨™ï¼Œå¯ä»¥å¹«åŠ©é–‹ç™¼è€…åšç‚ºå„ªåŒ–ç¶²ç«™çš„åƒè€ƒã€‚ä»¥ä½¿ç”¨è€…é«”é©—ç‚ºä¸­å¿ƒæå‡ºäº†ä¸‰å€‹æ”¹å–„é¢å‘ï¼Œæ¯å€‹é¢å‘æœ‰ä»¥ä¸‹å„è‡ªå°æ‡‰çš„æŒ‡æ¨™ï¼š</p><ol><li>è¼‰å…¥é€Ÿåº¦(Loading Performance)<ol><li><strong>Largest Contentful Paint (LCP)</strong></li><li>First Contentful Paint (FCP)</li><li>Time to First Byte (TTFB)</li></ol></li><li>äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)<ol><li><strong>First Input Delay (FID)</strong></li><li>Time to Interactive (TTI)</li><li>Total Blocking Time (TBT)</li></ol></li><li>è¦–è¦ºç©©å®šæ€§(Visual Stability)<ol><li><strong>Cumulative Layout Shift (CLS)</strong></li><li>Speed Index (SI)</li></ol></li></ol><p>å…¶ä¸­<strong>LCP, FID, CLS</strong>æ˜¯ä¸‰å€‹è¼ƒç‚ºé‡è¦ä»£è¡¨å„é¢å‘çš„<strong>æ ¸å¿ƒæŒ‡æ¨™(Core Web Vitals)</strong>ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„-web-vitalsï¼Ÿ"></a>å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„ Web Vitalsï¼Ÿ<a class="hash-link" href="#å¦‚ä½•æ¸¬é‡ç¶²ç«™çš„-web-vitalsï¼Ÿ" title="Direct link to heading">#</a></h2><p>æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥å¹«æˆ‘å€‘è§£æç¶²ç«™æ•ˆèƒ½ï¼Œä¸¦ä¸”ç”¢ç”Ÿå‡ºé€™äº›é‡åŒ–æŒ‡æ¨™åˆ†æ•¸ä»¥åŠæ”¹å–„å»ºè­°çš„åˆ†æå ±å‘Šï¼Œä¾ç…§ç’°å¢ƒåˆ†æˆå…©ç¨®æ¸¬é‡æ–¹å¼ï¼Œä¸åŒæ–¹å¼æœ‰å„è‡ªçš„å·¥å…·ï¼š</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¯¦é©—æ¨¡æ“¬æ¸¬é‡in-the-lab"></a>å¯¦é©—æ¨¡æ“¬æ¸¬é‡(In the lab)<a class="hash-link" href="#å¯¦é©—æ¨¡æ“¬æ¸¬é‡in-the-lab" title="Direct link to heading">#</a></h3><p>æ¨¡æ“¬æ¸¬é‡å·¥å…·æœƒå»æ¨¡æ“¬ä½¿ç”¨è€…çš„æ“ä½œè¡Œç‚ºï¼Œä½¿ç”¨æ¨¡æ“¬è³‡æ–™è©•åˆ†ï¼Œæä¾›å¯ä»¥é‡ç¾çš„çµæœï¼Œé©åˆç”¨åœ¨ç”¢å“é–‹ç™¼éšæ®µåšåˆ†æåŠé©—è­‰ã€‚</p><ul><li><a href="https://developers.google.com/web/tools/lighthouse/" target="_blank" rel="noopener noreferrer">Lighthouse</a></li><li><a href="https://github.com/GoogleChrome/lighthouse-ci" target="_blank" rel="noopener noreferrer">Lighthouse CI</a>ï¼Œè¨­å®šåœ¨ PR æ™‚è‡ªå‹•åŒ–è·‘ Lighthouse ç”¢ç”Ÿæ¸¬é‡å ±å‘Šã€‚</li><li><a href="https://developer.chrome.com/docs/devtools/evaluate-performance/" target="_blank" rel="noopener noreferrer">Chrome DevTools Performance panel</a>ï¼Œå¯ä»¥éŒ„è£½ç•«é¢ï¼Œæ›´æ·±å…¥é‡å°æŸæ®µ frame åšå„ªåŒ–ã€‚</li><li><a href="https://webpagetest.org/" target="_blank" rel="noopener noreferrer">WebPageTest</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¯¦æ¸¬in-the-field"></a>å¯¦æ¸¬(In the field)<a class="hash-link" href="#å¯¦æ¸¬in-the-field" title="Direct link to heading">#</a></h3><p>ä¹Ÿè¢«ç¨±ç‚º Real User Monitoring(RUM)ï¼Œå¯¦æ¸¬å·¥å…·æœƒä½¿ç”¨å¾çœŸå¯¦ä½¿ç”¨è€…è’é›†ä¾†çš„åŒ¿åä½¿ç”¨è¡Œç‚ºè³‡æ–™è©•åˆ†ï¼Œå¯ä»¥çŸ¥é“ä½¿ç”¨è€…çœŸå¯¦é«”é©—ç‹€æ³ï¼Œä½†åˆ†æ•¸ä¹Ÿæœƒå—ä½¿ç”¨è€…ç•¶ä¸‹è£ç½®å½±éŸ¿ï¼Œä¾‹å¦‚ä½¿ç”¨è€…çš„ç¶²è·¯ç‹€æ³ä¸ä½³ï¼Œæˆ–æ˜¯æ¯å€‹ä½¿ç”¨è€…æœƒé¡¯ç¤ºä¸åŒçš„å®¢è£½åŒ–è³‡æ–™ï¼Œéƒ½æœƒå½±éŸ¿æ¸¬é‡è©•åˆ†ï¼Œå› æ­¤å¯èƒ½æœƒè·Ÿæ¨¡æ“¬æ¸¬é‡çµæœæœ‰å·®è·ã€‚</p><ul><li><a href="https://developers.google.com/speed/pagespeed/insights/?hl=zh-TW" target="_blank" rel="noopener noreferrer">PageSpeed Insights</a></li><li><a href="https://search.google.com/search-console/about" target="_blank" rel="noopener noreferrer">Search Console</a></li><li><a href="https://developers.google.com/web/tools/chrome-user-experience-report" target="_blank" rel="noopener noreferrer">Chrome User Experience Report</a> API</li><li><a href="https://firebase.google.com/docs/perf-mon" target="_blank" rel="noopener noreferrer">Firebase Performance Monitoring</a></li><li><a href="https://github.com/GoogleChrome/web-vitals-extension" target="_blank" rel="noopener noreferrer">Web Vitals Chrome Extension</a></li></ul><p>å¦‚æœéœ€è¦æ›´è©³ç´°çš„ä½¿ç”¨è¡Œç‚ºè³‡æ–™å¯ä»¥ä½¿ç”¨ <a href="https://github.com/GoogleChrome/web-vitals" target="_blank" rel="noopener noreferrer">web-vitals</a> javascript libraryï¼Œåœ¨è‡ªå·±çš„å°ˆæ¡ˆä¸­å¯¦ä½œ Real User Monitoringï¼Œä¾†è§€å¯Ÿä½¿ç”¨è€…å¯¦éš›æ“ä½œç´°ç¯€ï¼Œé©—è­‰åœ¨ç”¢å“ç’°å¢ƒä¸­æ•ˆèƒ½å•é¡Œæ˜¯å¦æœ‰æ”¹å–„ã€‚</p><blockquote><p>é€™ç¯‡æ–‡ç« ä¸æœƒå¤ªè©³ç´°è§£é‡‹æ¯å€‹æ¸¬é‡å·¥å…·è¨ˆç®—æŒ‡æ¨™åˆ†æ•¸çš„å…¬å¼ï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒå„æŒ‡æ¨™çš„æ¨™é¡Œè¶…é€£çµã€‚</p></blockquote><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­"></a>å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­<a class="hash-link" href="#å¦‚ä½•å°‡æ¸¬é‡å·¥å…·å°å…¥ç”¢å“é–‹ç™¼æµç¨‹ä¸­" title="Direct link to heading">#</a></h3><p>åƒè€ƒ <a href="https://web.dev/i18n/en/vitals-tools/" target="_blank" rel="noopener noreferrer">https://web.dev/i18n/en/vitals-tools/</a> æåˆ°çš„æµç¨‹</p><ol><li>ä½¿ç”¨ Search Console ç”¢ç”Ÿæ¯å€‹é é¢çš„æ ¸å¿ƒæŒ‡æ¨™æ¸¬é‡å ±å‘Šï¼Œæ‰¾åˆ°å“ªå€‹é é¢éœ€è¦ç‰¹åˆ¥é€²è¡Œå„ªåŒ–ã€‚</li><li>æ‰¾åˆ°éœ€è¦å„ªåŒ–çš„é é¢ URLï¼Œä½¿ç”¨ PageSpeed Insights æˆ–å…¶ä»– RUM å·¥å…·å¾—åˆ°åŒ…å« lab åŠ field çš„è©³ç´°æŒ‡æ¨™æ¸¬é‡çµæœè·Ÿå„ªåŒ–å»ºè­°ã€‚</li><li>åœ¨æœ¬åœ°é–‹ç™¼ç’°å¢ƒé…åˆå„ªåŒ–å»ºè­°é€²è¡Œä¿®æ­£ï¼Œé…åˆ Lighthouse è·Ÿ Chrome DevTools åšé©—è­‰ã€‚</li><li>ä½¿ç”¨ Lighthouse CI åœ¨ PR è‡ªå‹•åŒ–æ¸¬é‡ï¼Œé€šéè¨­å®šçš„æŒ‡æ¨™åˆ†æ•¸é–€æª»å¾Œæ‰ merge é€²ä¸»ç·šç„¶å¾Œ deploy productionã€‚</li><li>å›åˆ°æ­¥é©Ÿ 1 è·Ÿ 2ï¼Œé©—è­‰çœŸå¯¦ç”¢å“ç’°å¢ƒä¸­çš„æŒ‡æ¨™åˆ†æ•¸æ˜¯å¦çœŸçš„æœ‰å„ªåŒ–æˆåŠŸã€‚</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="è¼‰å…¥é€Ÿåº¦loading-performance"></a>è¼‰å…¥é€Ÿåº¦(Loading Performance)<a class="hash-link" href="#è¼‰å…¥é€Ÿåº¦loading-performance" title="Direct link to heading">#</a></h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é å¯ä»¥å¤šå¿«è¼‰å…¥å®Œæˆä¸¦ä¸”æ¸²æŸ“å¥½ç•«é¢ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="largest-contentful-paint-lcp"></a><a href="https://web.dev/lcp/" target="_blank" rel="noopener noreferrer">Largest Contentful Paint (LCP)</a><a class="hash-link" href="#largest-contentful-paint-lcp" title="Direct link to heading">#</a></h3><p><code>core web vital</code></p><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°æœ€å¤§é¢ç©çš„å…ƒç´ æ¸²æŸ“(render)åˆ°ç•«é¢ä¸Šæ‰€èŠ±çš„æ™‚é–“ã€‚</p><p><img alt="LCP.svg" src="/assets/images/LCP-706b1c82d2aa87bb213a431d7e4f53dd.svg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="first-contentful-paint-fcp"></a><a href="https://web.dev/fcp/" target="_blank" rel="noopener noreferrer">First Contentful Paint (FCP)</a><a class="hash-link" href="#first-contentful-paint-fcp" title="Direct link to heading">#</a></h3><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°ä»»ä½•ä¸€å€‹å…ƒç´ æ¸²æŸ“åˆ°ç•«é¢ä¸Šæ‰€èŠ±çš„æ™‚é–“ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="time-to-first-byte-ttfb"></a><a href="https://web.dev/ttfb/" target="_blank" rel="noopener noreferrer">Time to First Byte (TTFB)</a><a class="hash-link" href="#time-to-first-byte-ttfb" title="Direct link to heading">#</a></h3><p>ç€è¦½å™¨å°ä¼ºæœå™¨ç™¼å‡ºè«‹æ±‚(ex: http api request)å¾Œåˆ°æ”¶åˆ°å›æ‡‰è³‡æ–™(ç¬¬ä¸€å€‹ byte)æ‰€èŠ±çš„æ™‚é–“ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å„ªåŒ–æ–¹æ³•"></a>å„ªåŒ–æ–¹æ³•<a class="hash-link" href="#å„ªåŒ–æ–¹æ³•" title="Direct link to heading">#</a></h3><ul><li>åŠ é€Ÿå–å¾—è³‡æºçš„æ™‚é–“<ul><li>Cache<ul><li>CDN caching<ul><li>ä¾‹å¦‚ä½¿ç”¨ SSG å°‡éœæ…‹ HTML cache åœ¨ CDN</li></ul></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching" target="_blank" rel="noopener noreferrer">HTTP caching</a></li><li>service worker <a href="https://developers.google.com/web/tools/workbox/modules/workbox-precaching" target="_blank" rel="noopener noreferrer">Workbox Precaching</a></li><li>server cachingï¼Œå°‡éœæ…‹æª”æ¡ˆ cache åœ¨ server-side disk<ul><li>reverse proxies (Varnish, nginx)</li><li>cloud provider (Firebase, AWS, Azure)</li><li>CDN edge servers</li></ul></li></ul></li><li>åœ¨çœŸæ­£éœ€è¦åŸ·è¡Œä¹‹å‰é å…ˆä¸‹è¼‰å¥½è³‡æºï¼Œè¦ç”¨æ™‚å¯ä»¥ç›´æ¥é–‹å§‹åŸ·è¡Œï¼Œä½¿ç”¨ Resource Hints <code>preload</code>, <code>prefetch</code>ï¼Œä¾‹å¦‚ prefetch åˆ†é çš„ä¸‹ä¸€é æœƒç”¨åˆ°çš„è³‡æº</li><li>é å…ˆèˆ‡è³‡æºæœå‹™å™¨å»ºç«‹é€£ç·šï¼Œè¦ç”¨æ™‚å¯ä»¥æ›´å¿«ä¸‹è¼‰åˆ°è³‡æºï¼Œä½¿ç”¨ Resource Hints <code>dns-prefetch</code>, <code>preconnect</code>ï¼Œä¾‹å¦‚<a href="https://web.dev/optimize-lcp/#establish-third-party-connections-early" target="_blank" rel="noopener noreferrer">æ—©ä¸€é»èˆ‡ third-party å»ºç«‹é€£ç·š</a></li><li>æ¸›å°‘ HTTP request æ•¸é‡</li><li>åŠ é€Ÿå¾Œç«¯ä¼ºæœå™¨å›æ‡‰é€Ÿåº¦ï¼Œä¾‹å¦‚å„ªåŒ– DB query</li></ul></li><li>æ¸›å°‘è³‡æºé«”ç©ï¼Œæ›´å¿«å–å¾—åŠåŸ·è¡Œè³‡æºå…§å®¹<ul><li>æ¸›å°‘ server remote API response data é«”ç©ï¼Œä¾‹å¦‚ä¸æ‹¿å¤šé¤˜ç”¨ä¸åˆ°çš„è³‡æ–™</li><li>dynamic importï¼Œåœ¨éœ€è¦ç”¨åˆ°æ™‚æ‰è¼‰å…¥ module</li><li>route-based code splittingï¼Œç‰¹å®šé é¢åªè¼‰å…¥ç›¸é—œçš„è…³æœ¬èˆ‡æ¨£å¼æª”</li><li>tree shaking</li><li>partial importï¼Œåªå¾ module ä¸­è¼‰å…¥éœ€è¦ç”¨çš„ functionï¼Œä¸æ˜¯è¼‰å…¥æ•´å€‹ module</li><li>æ”¹å–„ webpack chunk è¨­å®šï¼Œæ¸›å°‘ bundle size</li><li>æ”¹å–„å¥—ä»¶ä½¿ç”¨æ–¹å¼ï¼Œç›¡é‡æŒ‘é¸é«”ç©å°çš„å¥—ä»¶ï¼Œç§»é™¤å¤šé¤˜å¼•ç”¨çš„å¥—ä»¶</li><li>åˆ†æ bundle size å·¥å…·ï¼š<ul><li><a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="noopener noreferrer">Webpack Bundle Analyzer</a></li><li><a href="https://www.npmjs.com/package/source-map-explorer" target="_blank" rel="noopener noreferrer">source-map-explorer</a></li><li><a href="https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost" target="_blank" rel="noopener noreferrer">Import Cost VSCode Extension</a></li></ul></li><li>ç²¾ç°¡ç¨‹å¼ç¢¼: åˆªé™¤ç”¨ä¸åˆ°çš„ç¨‹å¼ç¢¼ã€minify js &amp; css</li><li><a href="https://web.dev/serve-modern-code-to-modern-browsers/" target="_blank" rel="noopener noreferrer">æ¸›å°‘ polyfills é«”ç©</a><ul><li>ä½¿ç”¨@babel/preset-env åªé‡å°è¦æ”¯æ´çš„ç€è¦½å™¨ä½¿ç”¨ polyfill</li></ul></li></ul></li><li>ç€è¦½å™¨åœ¨ä¸‹è¼‰æˆ–åŸ·è¡Œè³‡æº(js, css)æ™‚æœƒæš«åœè§£æ HTML DOM åŠå»¶é²æ¸²æŸ“ç•«é¢(<strong>render-blocking</strong>)ï¼Œå› æ­¤æ¸›å°‘ render-blocking æ™‚é–“ä¹Ÿæ˜¯ä¸€å€‹æ–¹æ³•<ul><li>CSR å› ç‚ºæœ‰å¾ˆå¤š JS éœ€è¦åœ¨ç€è¦½å™¨åŸ·è¡Œï¼Œå° LCP å½±éŸ¿è¼ƒå¤§ï¼Œå¯ä»¥è€ƒæ…®æ”¹æˆä½¿ç”¨ server-side rendering æˆ–æ˜¯å…¶ä»– pre-rendering æ–¹å¼ï¼Œä½†å¯èƒ½ä¹Ÿæœƒå° TTFB åŠ TTI é€ æˆè² é¢å½±éŸ¿ï¼Œéœ€è¦è©•ä¼°æ˜¯å¦é©åˆè‡ªå·±çš„å°ˆæ¡ˆ</li><li>script tag ä½¿ç”¨ async å±¬æ€§ï¼Œè®“ js å¯ä»¥åœ¨èƒŒæ™¯ä¸‹è¼‰ä¸é˜»æ“‹æ¸²æŸ“ç•«é¢</li><li>script tag ä½¿ç”¨ defer å±¬æ€§ï¼Œè®“éé—œéµçš„ js å¯ä»¥å»¶é²åŸ·è¡Œä¸é˜»æ“‹æ¸²æŸ“ç•«é¢</li><li><a href="https://web.dev/optimize-lcp/#defer-non-critical-css" target="_blank" rel="noopener noreferrer">å»¶é²è¼‰å…¥éé—œéµçš„ CSS</a><ul><li><a href="https://github.com/filamentgroup/loadCSS" target="_blank" rel="noopener noreferrer">loadCSS</a></li></ul></li><li>åŠ é€Ÿå–å¾—è³‡æºçš„æ™‚é–“ä»¥åŠæ¸›å°‘è³‡æºé«”ç©ä¹Ÿå¯ä»¥å¹«åŠ©æ¸›å°‘ render-blocking æ™‚é–“</li></ul></li><li>å„ªåŒ–åœ–ç‰‡<ul><li><a href="https://web.dev/serve-responsive-images/" target="_blank" rel="noopener noreferrer">éŸ¿æ‡‰å¼åœ–æª”</a>ï¼Œæ ¹æ“šè£ç½®å°ºå¯¸æ‹¿å–å°æ‡‰è¶³å¤ çš„åœ–ç‰‡å°ºå¯¸</li><li>ä½¿ç”¨ WebPã€AVIF æ ¼å¼</li><li>Image Server (<a href="https://cloudinary.com/" target="_blank" rel="noopener noreferrer">Cloudinary</a>)</li><li>lazy loading</li><li>å£“ç¸®åœ–ç‰‡(<a href="https://web.dev/use-imagemin-to-compress-images/" target="_blank" rel="noopener noreferrer">Imagemin</a>)</li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="äº’å‹•åæ‡‰èƒ½åŠ›interactivity"></a>äº’å‹•åæ‡‰èƒ½åŠ›(Interactivity)<a class="hash-link" href="#äº’å‹•åæ‡‰èƒ½åŠ›interactivity" title="Direct link to heading">#</a></h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é å¤šå¿«å¯ä»¥å›æ‡‰ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºï¼Œä¾‹å¦‚æŒ‰ä¸‹æŒ‰éˆ•ä¹‹å¾Œå¤šä¹…æœƒæœ‰åæ‡‰ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="first-input-delay-fid"></a><a href="https://web.dev/fid/" target="_blank" rel="noopener noreferrer">First Input Delay (FID)</a><a class="hash-link" href="#first-input-delay-fid" title="Direct link to heading">#</a></h3><p><code>core web vital</code></p><p>ä½¿ç”¨è€…é¦–æ¬¡èˆ‡ç¶²ç«™äº’å‹•ï¼Œç›´åˆ°ç€è¦½å™¨å›æ‡‰äº’å‹•äº‹ä»¶çš„æ™‚é–“å·®ã€‚é€™å€‹æŒ‡æ¨™æœƒå› ç‚ºçœŸå¯¦ä½¿ç”¨è€…é¦–æ¬¡äº’å‹•è¡Œç‚ºè€Œæœ‰æ‰€ä¸åŒï¼Œæ‰€ä»¥åªèƒ½å¯¦æ¸¬(field)ç„¡æ³•æ¨¡æ“¬æ¸¬é‡(lab)ã€‚åœ¨é–‹ç™¼éšæ®µå› ç‚ºæ²’æœ‰è¾¦æ³•å¯¦æ¸¬ï¼Œå¯ä»¥è—‰ç”±å„ªåŒ–æœ‰é—œè¯æ€§çš„ TBT æŒ‡æ¨™ä¾†å”åŠ©æ”¹å–„ FIDã€‚</p><p><img alt="FID.svg" src="/assets/images/FID-3ccf17e6da41287b4d3f58e7e00b9a55.svg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="time-to-interactive-tti"></a><a href="https://web.dev/tti/" target="_blank" rel="noopener noreferrer">Time to Interactive (TTI)</a><a class="hash-link" href="#time-to-interactive-tti" title="Direct link to heading">#</a></h3><p>å¾ç¶²é é–‹å§‹è¼‰å…¥åˆ°é•·æ™‚é–“ä»»å‹™(long tasks)éƒ½å·²ç¶“çµæŸè€Œä¸”å¯ä»¥å›æ‡‰ä½¿ç”¨è€…äº’å‹•æ‰€èŠ±çš„æ™‚é–“ã€‚</p><p>é•·æ™‚é–“ä»»å‹™(long tasks)æ˜¯æŒ‡è¶…é 50ms çš„ä»»å‹™ï¼Œå¯èƒ½æ˜¯è§£æ HTML å»ºç«‹ DOM Treeã€è§£æ CSS å¥—ç”¨æ¨£å¼ã€åŸ·è¡Œ JS ç­‰ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="total-blocking-time-tbt"></a><a href="https://web.dev/tbt/" target="_blank" rel="noopener noreferrer">Total Blocking Time (TBT)</a><a class="hash-link" href="#total-blocking-time-tbt" title="Direct link to heading">#</a></h3><p>ä¸»åŸ·è¡Œç·’è¢«é•·æ™‚é–“ä»»å‹™(long tasks)é˜»å¡çš„ç¸½æ™‚é–“ï¼Œé˜»å¡çš„æ™‚é–“æ˜¯æŒ‡é•·æ™‚é–“ä»»å‹™ä¸­è¶…é 50ms çš„æ™‚é–“(long task time - 50ms)ï¼Œå°‡æ¯å€‹ long task é˜»å¡æ™‚é–“åšç¸½å’Œå°±æ˜¯ TBTï¼Œé€™æ®µæ™‚é–“è¢«è¦–ç‚ºç„¡æ³•å›æ‡‰ä½¿ç”¨è€…äº’å‹•çš„æ™‚é–“ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å„ªåŒ–æ–¹æ³•-1"></a>å„ªåŒ–æ–¹æ³•<a class="hash-link" href="#å„ªåŒ–æ–¹æ³•-1" title="Direct link to heading">#</a></h3><p>å»¶é²äº’å‹•å›æ‡‰æ™‚é–“çš„ä¸»è¦åŸå› æ˜¯ç¹é‡çš„ js åŸ·è¡Œä»»å‹™ä½”ç”¨è‘—ä¸»åŸ·è¡Œç·’ï¼Œè®“ç€è¦½å™¨ç„¡æ³•è™•ç†ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºäº‹ä»¶ï¼Œå› æ­¤<strong><a href="https://web.dev/mainthread-work-breakdown/" target="_blank" rel="noopener noreferrer">æ¸›å°‘ä¸»åŸ·è¡Œç·’è² æ“”</a>å¯ä»¥æœ‰æ•ˆæ”¹å–„</strong>ã€‚</p><ul><li>æ¸›å°‘ JS åŸ·è¡Œæ™‚é–“ï¼Œå¯ä»¥åƒè€ƒ<a href="https://www.notion.so/Web-Vitals-2345c615d06945bd985eb2bf1033000f" target="_blank" rel="noopener noreferrer">ä¸Šè¿°å·²ç¶“æåˆ°çš„æ–¹æ³•</a></li><li>æ‹†åˆ† long taskï¼Œcode-split js bundle æ‹†åˆ†æˆå¤šå€‹å¯ä»¥éåŒæ­¥åŸ·è¡Œçš„å°æª”æ¡ˆ(chunk)ï¼Œé…åˆ async, defer å±¬æ€§</li><li>å»¶é²åŸ·è¡Œä¸é‡è¦çš„è³‡æºï¼Œä¾‹å¦‚ä½¿ç”¨ script tag defer å±¬æ€§</li><li>ä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Worker" target="_blank" rel="noopener noreferrer">web workers</a>ï¼Œè®“ js åœ¨å¦ä¸€å€‹èƒŒæ™¯åŸ·è¡Œç·’åŸ·è¡Œï¼Œå¥—ä»¶: <a href="https://github.com/GoogleChromeLabs/comlink" target="_blank" rel="noopener noreferrer">Comlink</a></li><li>å…ˆæº–å‚™å¥½äº’å‹•è¡Œç‚ºéœ€è¦çš„è³‡æ–™ï¼Œä¾‹å¦‚ç›¡é‡é¿å…åœ¨äº’å‹•æ™‚æ‰å»æ‰“ api fetch è³‡æ–™</li><li>Debounce</li><li>Throttle</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="è¦–è¦ºç©©å®šæ€§visual-stability"></a>è¦–è¦ºç©©å®šæ€§(Visual Stability)<a class="hash-link" href="#è¦–è¦ºç©©å®šæ€§visual-stability" title="Direct link to heading">#</a></h2><p>ç›®æ¨™æ˜¯è¦è©•ä¼°ç¶²é ä¸Šçš„å…ƒç´ æ˜¯å¦ç™¼ç”Ÿæœªé æœŸçš„ä½ç½®æ”¹è®Šè€Œå½±éŸ¿ä½¿ç”¨è€…çš„äº’å‹•è¡Œç‚ºï¼Œä¾‹å¦‚è¦æŒ‰ä¸‹æŒ‰éˆ•æ™‚çªç„¶è·³å‡ºå»£å‘Šã€‚ä»¥åŠè©•ä¼°è½‰å ´æˆ–å‹•ç•«çš„æ¸²æŸ“æœ‰ç¶­æŒä¸€å®šçš„ frame rateï¼Œç•«é¢ä¸Šæ¯å€‹ç‹€æ…‹çš„æ”¹è®Šæ˜¯æµæš¢çš„ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cumulative-layout-shift-cls"></a><a href="https://web.dev/cls/" target="_blank" rel="noopener noreferrer">Cumulative Layout Shift (CLS)</a><a class="hash-link" href="#cumulative-layout-shift-cls" title="Direct link to heading">#</a></h3><p><code>core web vital</code></p><p>ç´¯è¨ˆä½ˆå±€åç§»ï¼Œç•«é¢ç™¼ç”Ÿæœªé æœŸæ’ç‰ˆç§»å‹•çš„ç¨‹åº¦ï¼Œä¾‹å¦‚çªç„¶æ»‘å‡ºä¾†çš„å»£å‘Šå°±æœƒæœ‰å¾ˆå¤§çš„å½±éŸ¿ï¼Œè¼ƒä½çš„ CLS åˆ†æ•¸å¯ä»¥æœ‰åŠ©æ–¼è¦–è¦ºé«”é©—ä¸Šçš„èˆ’é©åº¦ã€‚</p><p><img alt="CLS.svg" src="/assets/images/CLS-dd385de9e97eef6b87ab0392fa6193c8.svg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="speed-index-si"></a><a href="https://web.dev/speed-index/" target="_blank" rel="noopener noreferrer">Speed Index (SI)</a><a class="hash-link" href="#speed-index-si" title="Direct link to heading">#</a></h3><p>ç¶²é è¼‰å…¥æœŸé–“å…§å®¹èƒ½å¤šå¿«è¢«ä½¿ç”¨è€…çœ‹åˆ°ï¼Œç”¨ä¾†è¡¡é‡è¦–è¦ºçš„æµæš¢æ€§ã€‚æ¸¬é‡å·¥å…·æœƒåœ¨ç¶²é è¼‰å…¥æœŸé–“éŒ„è£½å½±ç‰‡ï¼Œè¨ˆç®—æ¯å€‹ frame åœ¨è¦–è¦ºä¸Šçš„å…§å®¹å®Œæˆé€²åº¦ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å„ªåŒ–æ–¹æ³•-2"></a>å„ªåŒ–æ–¹æ³•<a class="hash-link" href="#å„ªåŒ–æ–¹æ³•-2" title="Direct link to heading">#</a></h3><ul><li>img, video, iframe è¨­å®š width, height å±¬æ€§ï¼Œæˆ–æ˜¯<a href="https://web.dev/optimize-cls/#images-without-dimensions" target="_blank" rel="noopener noreferrer">å¯¬é«˜æ¯”</a></li><li>é¿å…åœ¨ç¾æœ‰å…§å®¹ä¸Šæ–¹æ’å…¥å‹•æ…‹è¼‰å…¥çš„å…§å®¹ï¼Œå°è‡´æ¨æ“ åˆ°å…¶ä»–å…ƒä»¶çš„æ’ç‰ˆï¼Œå¯ä»¥å…ˆé ç•™å¥½éœ€è¦çš„ç©ºé–“(<a href="https://css-tricks.com/aspect-ratio-boxes/" target="_blank" rel="noopener noreferrer">CSS aspect ratio boxes</a>)ï¼Œæˆ–æ˜¯å°‡å—å½±éŸ¿çš„æ’ç‰ˆç§»åˆ°å¯è¦–ç¯„åœä¹‹å¤–</li><li>é¿å…çªç„¶ç§»å‹•æˆ–è“‹æ¿çš„å…§å®¹ï¼Œä¾‹å¦‚å»£å‘Šçªç„¶è·³å‡ºä¾†</li><li><a href="https://web.dev/optimize-cls/#web-fonts-causing-foutfoit" target="_blank" rel="noopener noreferrer">é˜²æ­¢ FOIT (flash of invisible text) æ–‡å­—çªç„¶å‡ºç¾ã€FOUT (flash of unstyled text) å­—é«”çªç„¶æ”¹è®Š</a><ul><li>ä½¿ç”¨<code>&lt;link rel=preload&gt;</code> ææ—©ä¸‹è¼‰å­—é«”ï¼Œ@font-face åŠ ä¸Š <code>font-display: optional</code> [<a href="https://web.dev/preload-optional-fonts/" target="_blank" rel="noopener noreferrer">åƒè€ƒ</a>]</li><li>google fonts url åŠ ä¸Š<code>&amp;display=swap</code></li></ul></li><li><a href="https://web.dev/optimize-cls/#animations" target="_blank" rel="noopener noreferrer">ç›¡é‡ä½¿ç”¨<code>transform</code>åšå‹•ç•«</a>ï¼Œç€è¦½å™¨é‹ç®—æˆæœ¬è¼ƒä½</li></ul><p>åœ¨å¯¦ä½œè¦–è¦ºç©©å®šæ€§çš„æ”¹å–„é€šå¸¸æœƒéœ€è¦ä½¿ç”¨åˆ°<a href="https://developer.chrome.com/docs/devtools/evaluate-performance/" target="_blank" rel="noopener noreferrer">Chrome DevTools Performance panel</a>ï¼Œå»åˆ†ææ¯å€‹ frame ç´°éƒ¨çš„ç‹€æ³ä¾†æ‰¾åˆ° root causeï¼Œ<a href="https://web.dev/debug-layout-shifts/" target="_blank" rel="noopener noreferrer">åƒè€ƒè©³ç´°å¦‚ä½• debug</a>ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç¸½çµ"></a>ç¸½çµ<a class="hash-link" href="#ç¸½çµ" title="Direct link to heading">#</a></h2><p>é€™ç¯‡æ–‡ç« å°‡æœƒè·Ÿè‘— Google åœ¨ Web Vitals ä¸Šçš„æ–°ææ¡ˆä»¥åŠç­†è€…è‡ªèº«çš„ç ”ç©¶æŒçºŒæ›´æ–°ï¼Œå¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°éƒ½æ­¡è¿èˆ‡æˆ‘è¯çµ¡ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://web.dev/learn-web-vitals/" target="_blank" rel="noopener noreferrer">Web Vitals</a></p><p><a href="https://www.youtube.com/watch?v=_o0Q-fUjeiA&amp;t=27s&amp;ab_channel=GoogleDevelopersTaiwan-Google%E9%96%8B%E7%99%BC%E4%BA%BA%E5%93%A1%E5%8F%B0%E7%81%A3%E9%A0%BB%E9%81%93" target="_blank" rel="noopener noreferrer">I/O Extended 2021 ç³»åˆ—: Chrome DevTools &amp; Web Vitals</a></p><p><a href="https://cythilya.github.io/2021/10/24/mopcon-speed-up-your-app-with-web-vitals/?fbclid=IwAR3GXoUWjr9GXFaYZBjR4NMfiiucoGAIOtjSG8sRg02BFg86qlFF55u6fq4" target="_blank" rel="noopener noreferrer">æ‰“é€ é«˜é€Ÿç¶²ç«™ï¼Œå¾ç¶²ç«™æŒ‡æ¨™é–‹å§‹ï¼(Speed Up Your App with Web Vitals) MOPCON 2021 é€å­—ç¨¿ | Summerã€‚æ¡‘è«ã€‚å¤å¤©</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/performance">performance</a><a class="margin-horiz--sm" href="/tags/web-vitals">web vitals</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/solve-seo-problems-with-prerenderio">Prerender.ioå¦‚ä½•å¹«åŠ©CSRçš„SEO - åŸç†ä»‹ç´¹èˆ‡ä½¿ç”¨æ•™å­¸</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-07T00:00:00.000Z">November 7, 2021</time> Â· 3 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Client-Side Rendering (CSR) Single Page Application (SPA) æœ€å¸¸é‡åˆ°çš„å•é¡Œå°±æ˜¯ SEOï¼Œè§£æ±ºé€™å€‹å•é¡Œçš„æ–¹æ³•æœ‰å¾ˆå¤šç¨®ï¼Œå…¶ä¸­ä¸€ç¨®ç²å¾— Google æ¨è–¦çš„æ–¹æ³•æ˜¯<strong>Prerender.io</strong>ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒä»‹ç´¹å®ƒçš„é‹ä½œåŸç†ä»¥åŠå¦‚ä½•é–‹å§‹å°å…¥ä½¿ç”¨ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="é–‹å§‹ä¹‹å‰ï¼Œå…ˆèŠèŠ-csr-çš„-seo-å•é¡Œ"></a>é–‹å§‹ä¹‹å‰ï¼Œå…ˆèŠèŠ CSR çš„ SEO å•é¡Œ<a class="hash-link" href="#é–‹å§‹ä¹‹å‰ï¼Œå…ˆèŠèŠ-csr-çš„-seo-å•é¡Œ" title="Direct link to heading">#</a></h2><p>Client-Side Rendering (CSR) æ˜¯éå»å¹¾å¹´æµè¡Œçš„å‰ç«¯é–‹ç™¼æ–¹å¼ï¼Œç€è¦½å™¨æœƒæ”¶åˆ°ä¸€å€‹ body è£¡åªæœ‰æ ¹å…ƒä»¶ä»¥åŠå¼•å…¥æ‰“åŒ…å¥½çš„ JS çš„ HTMLï¼Œè§£æ HTML å¾Œé–‹å§‹ä¸‹è¼‰åŠåŸ·è¡Œ JS å°‡å…§å®¹æ¸²æŸ“é€²æ ¹å…ƒä»¶ä¸­ï¼Œå¤§éƒ¨åˆ†çš„é‹ç®—è³‡æºæœƒé›†ä¸­åœ¨ç€è¦½å™¨ä¸Šï¼Œè€Œæœ€å¤§çš„å•é¡Œæ˜¯æœå°‹å¼•æ“åš SEO çš„çˆ¬èŸ²ä¸¦ä¸æœƒç­‰å¾… AJAX è·Ÿ JS æ¸²æŸ“å¥½å…§å®¹æ‰é–‹å§‹è’é›†è³‡æ–™ï¼Œä»–åªæœƒçœ‹åˆ° HTML ä¸­ä¸€å€‹ç©ºç©ºçš„æ ¹å…ƒä»¶ï¼Œæ²’æœ‰è³‡æ–™å¯ä»¥çµ¦ä»–åš Indexï¼Œé›–ç„¶ Google Search å¾Œä¾†ä¹Ÿæœ‰<a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics" target="_blank" rel="noopener noreferrer">æ–°çš„çˆ¬èŸ²æ©Ÿåˆ¶</a>è§£æ±ºé€™å€‹å•é¡Œï¼Œä½†çˆ¬èŸ²ä¹Ÿæœ‰<a href="https://prerender.io/crawl-budget-seo/" target="_blank" rel="noopener noreferrer">è³‡æºé ç®—</a>(Crawl Budget)é™åˆ¶ï¼ŒCSR éœ€è¦èŠ±è²»å¤§é‡çˆ¬èŸ²é‹ç®—è³‡æºï¼Œå°è‡´ Index æœƒéœ€è¦å¾ˆå¤šæ™‚é–“ç”šè‡³æœ‰äº›é é¢ä¹Ÿç„¡æ³•åš Indexï¼Œå¦å¤–ä¸€å€‹å•é¡Œæ˜¯ç¤¾äº¤åª’é«”ä¾‹å¦‚ FB, Twitter éœ€è¦çš„<a href="https://ahrefs.com/blog/open-graph-meta-tags/" target="_blank" rel="noopener noreferrer">open graph meta tag</a>å¦‚æœæ˜¯ CSR å‹•æ…‹ç”¢ç”Ÿçš„è©±ä¸€é–‹å§‹ä¹Ÿæœƒæ‹¿ä¸åˆ°ï¼Œæ–¼æ˜¯é–‹å§‹æœ‰äººæå‡ºå¾ˆå¤šäº‹å…ˆæ¸²æŸ“(pre-rendering)å¥½éœæ…‹ HTML å†é€çµ¦ client çš„è§£æ³•ï¼Œä»¥ä¸‹åˆ—èˆ‰å¹¾ç¨®ï¼š</p><ol><li>Pre-build æˆ–ç¨± Static Site Generator (SSG)ï¼Œæ˜¯åœ¨ build-time æº–å‚™å¥½æ¯å€‹è·¯ç”±(Route)éœ€è¦çš„è³‡æ–™ä¸¦å»ºç«‹å‡ºå®Œæ•´çš„éœæ…‹ HTMLï¼Œserver æ”¶åˆ°è«‹æ±‚æ™‚ç›´æ¥å›å‚³å·²ç¶“å»ºç«‹å¥½çš„ HTMLï¼Œå¸¸è¦‹çš„å·¥å…·åŒ…å«<a href="https://github.com/stereobooster/react-snap" target="_blank" rel="noopener noreferrer">react-snap</a>ï¼Œ<a href="https://www.11ty.dev/" target="_blank" rel="noopener noreferrer">Eleventy</a>ï¼Œé€™å€‹æ–¹æ³•çš„å„ªé»åŒ…å«å¯ä»¥åœ¨ CDN cache HTML ç¸®çŸ­è«‹æ±‚å›å‚³æ™‚é–“ä»¥åŠ<a href="https://web.dev/fcp/" target="_blank" rel="noopener noreferrer">First Contentful Paint (FCP)</a>æ™‚é–“ï¼Œç¼ºé»å‰‡æ˜¯å› ç‚ºæ˜¯åœ¨ build-time ç”¢ç”Ÿ HTMLï¼Œæ¯æ¬¡æœ‰å…§å®¹è®Šå‹•éƒ½è¦é‡ buildï¼Œå°æ–¼å…§å®¹è®Šå‹•é »ç‡é«˜çš„ç¶²ç«™æœƒå¾ˆéº»ç…©ï¼Œä¹Ÿæœƒå»¶é•· build çš„æ™‚é–“ã€‚</li><li>Server-Side Rendering (SSR)ï¼Œç›¸å°æ–¼ SSG ä¾†èªªå®ƒå‰‡æ˜¯åœ¨ run-time å»ºç«‹å¥½ HTMLï¼Œç•¶ server æ”¶åˆ°æŸå€‹è·¯ç”±çš„è«‹æ±‚å¾Œé–‹å§‹æº–å‚™éœ€è¦çš„è³‡æ–™ä¸¦å»ºç«‹å¥½ HTML å›å‚³çµ¦ clientï¼Œè§£æ±ºäº† SSG çš„å•é¡ŒåŒæ™‚ç¹¼æ‰¿å…¶å„ªé»ï¼Œä½†ä¹Ÿæœ‰å®ƒæœ¬èº«çš„çš„å•é¡Œï¼Œå°±æ˜¯æœƒæå‡é–‹ç™¼è¤‡é›œåº¦ï¼Œä»¥åŠç¾æœ‰çš„ CSR å°ˆæ¡ˆé›£ä»¥è½‰æ›æˆ SSR æ¶æ§‹ï¼Œå¸¸è¦‹çš„å·¥å…·æ¡†æ¶åŒ…å« React çš„<a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">Next.js</a>ï¼ŒVue çš„<a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer">Nuxt.js</a>ã€‚ï¼ˆä¸éé€™é¡æ¡†æ¶é‚„æ˜¯æœ‰å¾ˆå¤šå¾ˆé¦™çš„ç‰¹è‰²ï¼‰</li><li>Prerender.io</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerenderio-é‹ä½œåŸç†---dynamic-rendering"></a>Prerender.io é‹ä½œåŸç† - Dynamic Rendering<a class="hash-link" href="#prerenderio-é‹ä½œåŸç†---dynamic-rendering" title="Direct link to heading">#</a></h2><p><img alt="Screen Shot 2021-11-08 at 11.11.38 AM.png" src="/assets/images/prerenderio-eaa86238665cb1f1713fa10066d9e922.png"></p><p><a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io</a>é‹ä½œæµç¨‹æ˜¯ç•¶å‰ç«¯çš„ web server æ”¶åˆ°è«‹æ±‚æ™‚é€é Prerender-node Middleware å»è¾¨è­˜é€™å€‹è«‹æ±‚æ˜¯å¾ç€è¦½å™¨é‚„æ˜¯å¾çˆ¬èŸ²ç™¼å‡ºçš„ï¼Œå¦‚æœæ˜¯ç€è¦½å™¨å°±ä¾ç…§åŸæœ¬çš„ CSR æ©Ÿåˆ¶ï¼Œå¦‚æœæ˜¯çˆ¬èŸ²æ‰éœ€è¦åš prerenderï¼Œæœƒå§”è¨— Prerender.io cloud service å¹«æˆ‘å€‘æ¸²æŸ“å‡ºéœæ…‹ HTML å†å›å‚³çµ¦ web server ç„¶å¾Œå†å›çµ¦çˆ¬èŸ²ï¼Œé€™æ¨£çš„æ¸²æŸ“æ–¹å¼ç¨±ç‚º<a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering" target="_blank" rel="noopener noreferrer">Dynamic Rendering</a>ã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="è¾¨è­˜çˆ¬èŸ²çš„æ–¹æ³•"></a>è¾¨è­˜çˆ¬èŸ²çš„æ–¹æ³•<a class="hash-link" href="#è¾¨è­˜çˆ¬èŸ²çš„æ–¹æ³•" title="Direct link to heading">#</a></h3><p>åˆ©ç”¨ request header ä¸­ user-agent çš„å€¼ï¼Œå¦‚æœæ˜¯ google search çš„çˆ¬èŸ²æœƒå¸¶ä¸Š <code>googlebot</code> ï¼Œç›®å‰æ”¯æ´çš„çˆ¬èŸ²æœ‰é€™äº›ï¼š</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">prerender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">crawlerUserAgents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;googlebot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Yahoo! Slurp&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;bingbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;yandex&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;baiduspider&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;facebookexternalhit&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;twitterbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;rogerbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;linkedinbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;embedly&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;quora link preview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;showyoubot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;outbrain&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;pinterest/0.&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;developers.google.com/+/web/snippet&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;slackbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;vkShare&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;W3C_Validator&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;redditbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Applebot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;WhatsApp&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;flipboard&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;tumblr&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;bitlybot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;SkypeUriPreview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;nuzzel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Discordbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Google Page Speed&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Qwantify&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;pinterestbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Bitrix link preview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;XING-contenttabreceiver&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Chrome-Lighthouse&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;TelegramBot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="çˆ¬èŸ²ç²å–éœæ…‹-html-çš„æ–¹æ³•"></a>çˆ¬èŸ²ç²å–éœæ…‹ HTML çš„æ–¹æ³•<a class="hash-link" href="#çˆ¬èŸ²ç²å–éœæ…‹-html-çš„æ–¹æ³•" title="Direct link to heading">#</a></h3><p>æˆ‘å€‘çš„ web server è¦å»æ‰“ Prerender.io æä¾›çš„ GET API ä¸¦å¸¶ä¸Šçˆ¬èŸ²è«‹æ±‚çš„è·¯ç”±ï¼ŒPrerender.io æœƒé–‹ä¸€å€‹<a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener noreferrer">Headless Chrome</a>å»è·Ÿæˆ‘å€‘çš„ server è«‹æ±‚è©²è·¯ç”±çš„è³‡æ–™ä¾†æ¸²æŸ“ HTMLï¼Œé€™æ®µå…¶å¯¦ç­‰åŒä½¿ç”¨ Headless Chrome åœ¨åš CSRï¼Œå†é€é HTTP åˆ†å¡Š(chunk)å‚³è¼¸å¾åŸæœ¬çš„ API å›å‚³æ¸²æŸ“å¥½çš„ HTML çµ¦æˆ‘å€‘çš„ serverï¼Œserver æ”¶åˆ°å¾Œå†æŠŠ HTML å›è¦†çµ¦çˆ¬èŸ²çš„è«‹æ±‚ï¼Œå› æ­¤çˆ¬èŸ²å°±å¯ä»¥æ”¶åˆ°æ¸²æŸ“å¥½çš„éœæ…‹ HTML è€Œä¸”ä¸åŒ…å« JS æª”æ¡ˆã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">prerender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">plainResponse</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    content </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;end&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¦‚ä½•é–‹å§‹ä½¿ç”¨"></a>å¦‚ä½•é–‹å§‹ä½¿ç”¨<a class="hash-link" href="#å¦‚ä½•é–‹å§‹ä½¿ç”¨" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="åœ¨-dev-ç’°å¢ƒ"></a>åœ¨ Dev ç’°å¢ƒ<a class="hash-link" href="#åœ¨-dev-ç’°å¢ƒ" title="Direct link to heading">#</a></h3><p>å…ˆåœ¨ local è·‘ä¸€å°<a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">Prerender Node Server</a>ï¼Œå‡è¨­é–‹èµ·ä¾†çš„ URL æ˜¯ <code>http://localhost:3000</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/prerender/prerender.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> prerender</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">node server.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å®˜æ–¹æœ‰æä¾›å¤šç¨®èªè¨€çš„ open source server <a href="https://docs.prerender.io/article/12-middlewares" target="_blank" rel="noopener noreferrer">middleware</a>ï¼Œå¯ä»¥æŠŠå®ƒå®‰è£é€²æˆ‘å€‘çš„å‰ç«¯ web server ä¸­ï¼Œå¦‚æœä½ çš„ server æ˜¯ Node.js çš„è©±å¯ä»¥ç”¨<a href="https://github.com/prerender/prerender-node" target="_blank" rel="noopener noreferrer">prerender-node</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> prerender-node --save</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>å¼•å…¥ middleware</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>middleware ä¸­æœƒè®€å–ç’°å¢ƒè®Šæ•¸ <code>process.env.PRERENDER_SERVICE_URL</code> æ‰€ä»¥å¯ä»¥æŠŠå®ƒè¨­ç‚º <code>http://localhost:3000</code> ï¼Œæˆ–æ˜¯ç›´æ¥è¨­å®š middleware çš„ <code>prerenderServiceUrl</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prerenderServiceUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:3000&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerenderServiceUrl&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prerenderServiceUrl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>åŸ·è¡Œ curl æˆ–æ˜¯ä½¿ç”¨ browser extensionï¼Œä¾‹å¦‚<a href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=zh-TW" target="_blank" rel="noopener noreferrer">ModHeader</a>ï¼Œåœ¨ header ä¸­åŠ å…¥ user-agent: <code>Googlebot</code>ï¼Œå»æ‰“ä½ çš„ service æŸå€‹é é¢è·¯ç”±ï¼Œå‡è¨­ <code>https://www.example.com/</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -A Googlebot https://www.example.com/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä½ çš„ server æ”¶åˆ°è«‹æ±‚å¾Œï¼Œmiddleware å¦‚æœåˆ¤æ–·æ˜¯çˆ¬èŸ²å°±æœƒå»æ‰“ GET <code>http://localhost:3000/https://www.example.com/</code> ï¼Œè«‹æ±‚ Prerender Node Server æ¸²æŸ“ HTMLï¼Œä¹‹å¾Œå°±å¯ä»¥æ”¶åˆ°ä¸€å€‹å®Œæ•´æ¸²æŸ“å¥½æ²’æœ‰ script tag çš„éœæ…‹ HTMLã€‚</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="åœ¨-stage-ç’°å¢ƒ"></a>åœ¨ Stage ç’°å¢ƒ<a class="hash-link" href="#åœ¨-stage-ç’°å¢ƒ" title="Direct link to heading">#</a></h3><p>åœ¨<a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io</a>å®˜ç¶²è¨»å†Šæ–°å¸³è™Ÿæ‹¿åˆ° tokenï¼Œmiddleware ä¸­æœƒè®€å–ç’°å¢ƒè®Šæ•¸ <code>process.env.PRERENDER_TOKEN</code> å¯ä»¥æŠŠä»–è¨­å®šç‚ºä½ çš„ tokenï¼Œæˆ–æ˜¯ç›´æ¥è¨­å®šä»¥ä¸‹çš„ <code>prerenderToken</code>ã€‚</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerenderToken&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;YOUR_TOKEN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>é€šå¸¸ Stage server ä¸æœƒå°å¤–å…¬é–‹ï¼Œéœ€è¦å…ˆè¨­å®šç™½åå–®å…è¨±<a href="https://docs.prerender.io/article/22-ip-addresses" target="_blank" rel="noopener noreferrer">Prerender.io çš„ IP</a>ï¼Œè®“ä»–å€‘çš„ cloud service å¯ä»¥æ‰“é€² Stage server è«‹æ±‚é é¢è³‡æ–™ï¼Œå†ç…§è‘—ä¸€æ¨£çš„æ–¹æ³•å¸¶è‘—çˆ¬èŸ²çš„ user-agent å»æ‰“ä½ çš„ serviceï¼Œmiddleware æœƒå» GET <code>https://service.prerender.io/https://www.example.com/</code> ï¼Œè«‹æ±‚ cloud service æ¸²æŸ“ HTMLï¼Œä¹‹å¾Œå°±å¯ä»¥çœ‹åˆ° stage ç’°å¢ƒä¸‹çš„ prerendered HTMLï¼Œåœ¨å®˜ç¶²çš„ Dashboard ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°çˆ¬èŸ²è«‹æ±‚ç´€éŒ„ä»¥åŠè¢« cache çš„é é¢ã€‚</p><p>Stage è·Ÿ Production ä¹Ÿå¯ä»¥è€ƒæ…®ä¸ç”¨ä»–å€‘çš„ cloud serviceï¼Œè€Œæ˜¯å…§éƒ¨ç¶­è­·<a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">Prerender Node Server</a>ï¼Œåœ¨ middleware è¨­å®šå¥½ prerenderServiceUrl æ‰“åˆ°è‡ªå·±çš„ Prerender Node Serverã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerenderio-çš„å„ªç¼ºé»"></a>Prerender.io çš„å„ªç¼ºé»<a class="hash-link" href="#prerenderio-çš„å„ªç¼ºé»" title="Direct link to heading">#</a></h2><p>å„ªé»</p><ul><li>å¯¦ä½œèµ·ä¾†æ¯”å…¶ä»–è§£æ³•æ›´ç°¡å–®å¿«é€Ÿï¼Œåªè¦è¨­å®š server middlewareã€‚</li><li>ä»»ä½•ç¾æœ‰ CSR å‰ç«¯æ¡†æ¶ React, Vue, Angular éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</li><li>ä»‹é¢ä¸éŒ¯çš„ Dashboardã€‚</li><li>Cloud service æœ‰ cache æ©Ÿåˆ¶ï¼Œå¯ä»¥åœ¨ dashboard ä¸Šè¨­å®š cache æ™‚é–“ï¼Œå¦‚æœæœ‰ç‰¹åˆ¥é é¢éœ€æ±‚ä¹Ÿæœ‰æä¾›å»ºç«‹è·Ÿæ¸…é™¤ cache çš„ APIã€‚</li></ul><p>ç¼ºé»</p><ul><li><a href="https://prerender.io/pricing/" target="_blank" rel="noopener noreferrer">é¡å¤–é›²ç«¯æœå‹™æˆæœ¬</a>æˆ–æ˜¯è‡ªå·±ç¶­é‹<a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">Prerender Node Server</a>æˆæœ¬ï¼Œä¸éé€™é …å°æ–¼ä»»ä½• SSR æ–¹å¼æˆ–å¤šæˆ–å°‘éƒ½æœƒæœ‰ã€‚</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç¸½çµ"></a>ç¸½çµ<a class="hash-link" href="#ç¸½çµ" title="Direct link to heading">#</a></h2><p>é€™ç¯‡æ–‡ç« è¬›è§£äº† CSR é‡åˆ°çš„å•é¡Œèˆ‡ SSGã€SSRã€Prerender.io ä¸‰ç¨®è§£æ±ºæ–¹æ¡ˆï¼Œé‡å° Prerender.io ä»‹ç´¹å®ƒçš„é‹ä½œåŸç† Dynamic Renderingã€middleware ä½¿ç”¨æ–¹å¼ä»¥åŠå„ªç¼ºé»æ¯”è¼ƒï¼Œæ•´é«”ä¾†èªªæˆ‘è¦ºå¾— Prerender.io æ˜¯ä»‹æ–¼ SSG èˆ‡ SSR ä¹‹é–“è§£æ±º SEO å•é¡Œçš„æŠ˜è¡·æ–¹æ¡ˆï¼Œå¦‚æœæ˜¯ä»¥ä¸‹æƒ…å¢ƒï¼š</p><ol><li>å…·æœ‰ä¸€å®šè¦æ¨¡çš„ CSR SPA å°ˆæ¡ˆè½‰æ› SSR æ¶æ§‹æˆæœ¬éé«˜</li><li>ç¶²ç«™å…§å®¹è®Šæ›´é »ç‡é«˜</li><li>åªæƒ³å„ªåŒ– SEO</li></ol><p>é€™äº›æƒ…æ³ä¸‹ Prerender.io æœƒæ˜¯å€‹å»ºè­°å¯ä»¥è€ƒæ…®çš„è§£æ³•ï¼Œé‚„æœ‰å…¶ä»–æ›´å¤šç´°ç¯€ä¹Ÿå¯ä»¥åˆ°ä»–å€‘çš„å®˜æ–¹æ–‡ä»¶çœ‹çœ‹ã€‚</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Render Javascript With Search Engines in Mind | Prerender</a></p><p><a href="https://docs.prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io Knowledge Base</a></p><p><a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">https://github.com/prerender/prerender</a></p><p><a href="https://github.com/prerender/prerender-node" target="_blank" rel="noopener noreferrer">https://github.com/prerender/prerender-node</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering" target="_blank" rel="noopener noreferrer">Dynamic Rendering | Google Search Central | Google Developers</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics" target="_blank" rel="noopener noreferrer">Understand JavaScript SEO Basics | Google Search Central</a></p><p><a href="https://prerender.io/crawl-budget-seo/" target="_blank" rel="noopener noreferrer">Crawl Budget Optimization | Improve Crawl Health | Prerender</a></p><p><a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener noreferrer">Getting Started with Headless Chrome | Web | Google Developers</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/seo">seo</a><a class="margin-horiz--sm" href="/tags/prerender">prerender</a><a class="margin-horiz--sm" href="/tags/csr">csr</a><a class="margin-horiz--sm" href="/tags/ssr">ssr</a><a class="margin-horiz--sm" href="/tags/ssg">ssg</a><a class="margin-horiz--sm" href="/tags/prerender-io">prerender.io</a><a class="margin-horiz--sm" href="/tags/frontend">frontend</a><a class="margin-horiz--sm" href="/tags/web">web</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/script-tag-async-defer-attributes">[å‰ç«¯å„ªåŒ–ç³»åˆ—] ä½¿ç”¨async, deferå±¬æ€§åŠ é€Ÿç¶²é è¼‰å…¥æ™‚é–“</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-04T00:00:00.000Z">November 4, 2021</time> Â· One min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>ç€è¦½å™¨åœ¨è§£æ HTML æ™‚å¦‚æœé‡åˆ°<code>&lt;script&gt;...&lt;/script&gt;</code>å°±æœƒæš«åœè§£æç›´æ¥é–‹å§‹åŸ·è¡Œï¼Œå¦‚æœæ˜¯å¤–éƒ¨è³‡æº<code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code>æœƒç­‰å¾…ä¸‹è¼‰ä¸¦åŸ·è¡Œå®Œæˆä¹‹å¾Œæ‰é–‹å§‹ç¹¼çºŒè§£æ HTML å»ºç«‹ DOMï¼Œé€™æ¨£ç•¶é‡åˆ°å…§å®¹å¾ˆå¤šçš„ script æ™‚å°‡æœƒå»¶é•·é é¢æ¸²æŸ“çš„æ™‚é–“ï¼Œä¹Ÿæœƒè®“ä½¿ç”¨è€…æ›´æ…¢çœ‹åˆ°ç¶²é å…§å®¹å½±éŸ¿ä½¿ç”¨é«”é©—ã€‚</p><p><code>async</code>, <code>defer</code> æ­£æ˜¯ç‚ºäº†è§£æ±ºä¸Šè¿°å•é¡Œè€Œç”Ÿçš„å…©å€‹ script tag å±¬æ€§ï¼Œé€™ç¯‡æ–‡ç« æœƒä»‹ç´¹ä»–å€‘çš„å…±åŒé»èˆ‡ç›¸ç•°é»ï¼Œä»¥åŠå„è‡ªé©ç”¨çš„æƒ…å¢ƒã€‚</p><p><img alt="script-async-defer.png" src="/assets/images/script-async-defer-e7896ef157e507e7a3c7af930a42d504.png"></p><p>æ™‚åºåœ– (ä¾†æºï¼šSpeed up Google Maps(and everything else) with async &amp; defer)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="async-defer-çš„å…±åŒé»"></a>async, defer çš„å…±åŒé»<a class="hash-link" href="#async-defer-çš„å…±åŒé»" title="Direct link to heading">#</a></h2><ul><li>è§£æ HTML æ™‚è·‘åˆ°å°±é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ scriptï¼Œä¸‹è¼‰æ™‚ä¸é˜»æ“‹ç€è¦½å™¨è§£æ HTMLã€å»ºç«‹ DOMï¼Œå¦‚æ­¤ä¸€ä¾†é é¢æ¸²æŸ“å®Œæˆä½¿ç”¨è€…å°±å¯ä»¥å…ˆçœ‹åˆ°ç¶²é å…§å®¹ã€‚</li><li>åªå°å¾å¤–éƒ¨è¼‰å…¥çš„ script æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯æ²’æœ‰ src çš„ inline script æ²’æœ‰ä½œç”¨ï¼Œæœƒç›´æ¥é–‹å§‹åŸ·è¡Œã€‚</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="defer"></a>defer<a class="hash-link" href="#defer" title="Direct link to heading">#</a></h2><ul><li>DOM å»ºç«‹å®Œæˆä¹‹å¾Œæ‰é–‹å§‹åŸ·è¡Œ scriptã€‚</li><li>åŠ äº† defer çš„ script ä¹‹é–“æœƒç…§è‘—å¯«åœ¨ HTML çš„é †åºåŸ·è¡Œï¼Œå°±ç®—å…ˆä¸‹è¼‰å¥½äº†ä¹Ÿæœƒç­‰å‰é¢çš„åŸ·è¡Œå®Œæˆã€‚</li></ul><p>é©ç”¨æƒ…å¢ƒï¼š</p><p>ä¾è³´ DOM æˆ–å…¶ä»– scriptï¼Œä¾‹å¦‚æœƒéœ€è¦ä½¿ç”¨ HTML element æˆ–æ˜¯å…¶ä»– script çš„è³‡æ–™ï¼Œç¬¦åˆå¤§éƒ¨åˆ†çš„ä½¿ç”¨æƒ…å¢ƒï¼Œé€šå¸¸éƒ½å¯ä»¥åŠ ä¸Šé€™å€‹å±¬æ€§ï¼Œç„¶å¾ŒæŠŠ script tag æ”¾åœ¨<code>&lt;head&gt;</code>è£¡è®“ä»–ç›¡æ—©é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ï¼Œåªéœ€è¦æ³¨æ„å¯«åœ¨ HTML ä¸Šçš„åŸ·è¡Œå…ˆå¾Œé †åºã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="async"></a>async<a class="hash-link" href="#async" title="Direct link to heading">#</a></h2><ul><li>ä¸ç®¡ DOM å¥½äº†æ²’ï¼Œscript ä¸‹è¼‰å¥½å°±åŸ·è¡Œï¼Œé–‹å§‹åŸ·è¡Œä¹‹å¾Œä¾ç„¶æœƒæš«åœè§£æ HTMLã€‚</li><li>åŠ äº† async çš„ script ä¹‹é–“ä¸ä¿è­‰åŸ·è¡Œé †åºï¼Œä¹Ÿä¸æœƒç­‰å¾…å…¶ä»– scriptï¼Œå…ˆä¸‹è¼‰å¥½å…ˆåŸ·è¡Œã€‚</li></ul><p>é©ç”¨æƒ…å¢ƒï¼š</p><p>æ²’æœ‰ç›¸ä¾æ€§çš„ scriptï¼Œä¸ä¾è³´ DOM æˆ–å…¶ä»– scriptï¼Œèª°å…ˆåŸ·è¡Œéƒ½æ²’é—œä¿‚ï¼Œé©ç”¨æ–¼ç¨ç«‹çš„ç¬¬ä¸‰æ–¹ script åƒ GA, GTM, ads...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dynamic-scripts"></a>Dynamic scripts<a class="hash-link" href="#dynamic-scripts" title="Direct link to heading">#</a></h2><p>æœ‰æ™‚å€™å¯èƒ½æœƒå¯« js å‹•æ…‹å»ºç«‹ script tag ç„¶å¾Œæ’å…¥ HTMLï¼Œé€™æ¨£è¢«è¼‰å…¥çš„ script ç¨±ç‚º Dynamic scriptsï¼Œåƒæ˜¯é€™æ¨£ ğŸ‘‡</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> script </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;script&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">script</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">src </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/article/script-async-defer/long.js&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">body</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">script</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// (*)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>ä»¥é€™ç¨®æ–¹å¼æ’å…¥çš„ script é è¨­<code>async</code>æ•ˆæœï¼Œæ’å…¥ document ä¹‹å¾Œ<code>(*)</code>å°±é–‹å§‹èƒŒæ™¯ä¸‹è¼‰ã€‚å¦‚æœæƒ³è¦æ”¹æˆ<code>defer</code>åªè¦è¨­å®š<code>script.async=false</code>å°±å¯ä»¥äº†ï¼ŒèƒŒæ™¯ä¸‹è¼‰å®Œæˆå¾Œæœƒç…§è‘—æ’å…¥ document çš„é †åºåŸ·è¡Œ scriptã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¾ˆå°‘æœƒç›´æ¥æ’°å¯«-htmlï¼Œå¯¦å‹™ä¸Šæœƒæ€éº¼åšå‘¢ï¼Ÿ"></a>å¾ˆå°‘æœƒç›´æ¥æ’°å¯« HTMLï¼Œå¯¦å‹™ä¸Šæœƒæ€éº¼åšå‘¢ï¼Ÿ<a class="hash-link" href="#å¾ˆå°‘æœƒç›´æ¥æ’°å¯«-htmlï¼Œå¯¦å‹™ä¸Šæœƒæ€éº¼åšå‘¢ï¼Ÿ" title="Direct link to heading">#</a></h2><p>ç¾åœ¨é€šå¸¸æœƒä½¿ç”¨ webpack ä¾†æ‰“åŒ… jsï¼Œå¯ä»¥æ­é…<a href="https://github.com/jantimon/html-webpack-plugin#writing-your-own-templates" target="_blank" rel="noopener noreferrer">html-webpack-plugin</a>ï¼Œä»–æœƒç”Ÿæˆ HTML ä¸¦å¼•å…¥æ‰“åŒ…å¥½çš„ scriptï¼Œå¯ä»¥åœ¨ä½¿ç”¨æ™‚è¨­å®š<code>scriptLoading</code>åƒæ•¸ç‚º<code>defer</code>ã€‚</p><p>å‰©ä¸‹å…¶ä»–ç¬¬ä¸‰æ–¹çš„ script æœƒéœ€è¦ç›´æ¥å¯«åœ¨ HTML ä¸­ï¼Œé€™æ™‚å°±å¯ä»¥åŠ ä¸Š<code>acync</code>å±¬æ€§ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="ç¸½çµ"></a>ç¸½çµ<a class="hash-link" href="#ç¸½çµ" title="Direct link to heading">#</a></h2><p>é€™å…©å€‹å±¬æ€§è®“è¼‰å…¥é é¢æ™‚å¯ä»¥æ›´æ—©é–‹å§‹ä¸‹è¼‰ script åŒæ™‚è§£æ HTMLï¼Œç®—æ˜¯ä¸€å€‹å°å°èˆ‰æ‰‹ä¹‹å‹å°±å¯ä»¥åŠ é€Ÿç¶²é è¼‰å…¥æ™‚é–“çš„æ–¹æ³•å–”ã€‚</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script" target="_blank" rel="noopener noreferrer">The Script element - HTML: HyperText Markup Language | MDN</a></p><p><a href="https://javascript.info/script-async-defer" target="_blank" rel="noopener noreferrer">Scripts: async, defer</a></p><p><a href="https://flaviocopes.com/javascript-async-defer/" target="_blank" rel="noopener noreferrer">Efficiently load JavaScript with defer and async</a></p><p><a href="https://medium.com/schaoss-blog/02-html-script-tag-%E5%8A%A0%E4%B8%8A-async-defer-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%8F%8A%E5%B7%AE%E7%95%B0-8205fddbbafc" target="_blank" rel="noopener noreferrer">å‰ç«¯ä¸‰åï½œ 02. [HTML] script tag åŠ ä¸Š async &amp; defer çš„åŠŸèƒ½åŠå·®ç•°ï¼Ÿ</a></p><p><a href="https://pjchender.dev/javascript/js-async-defer/" target="_blank" rel="noopener noreferrer">[JS] Async, defer attributes | PJCHENder æœªæ•´ç†ç­†è¨˜</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/performance">performance</a><a class="margin-horiz--sm" href="/tags/frontend">frontend</a><a class="margin-horiz--sm" href="/tags/web">web</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/five-ways-to-defend-against-CSRF-attacks">[è³‡å®‰ç³»åˆ—] é˜²ç¦¦CSRFæ”»æ“Šçš„äº”ç¨®æ–¹æ³•</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-02T00:00:00.000Z">November 2, 2021</time> Â· 2 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p><img alt="charles-deluvio-pjAH2Ax4uWk-unsplash.jpg" src="/assets/images/charles-deluvio-pjAH2Ax4uWk-unsplash-5d822d3b9ed5acca5dee755a4078fff7.jpg"></p><figcaption align="center">Photo by <a href="https://unsplash.com/@charlesdeluvio?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener noreferrer">Charles Deluvio</a> on <a href="https://unsplash.com/s/photos/coding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener noreferrer">Unsplash</a></figcaption><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-is-csrf"></a>What is CSRF?<a class="hash-link" href="#what-is-csrf" title="Direct link to heading">#</a></h2><p>Cross Site Request Forgery è·¨ç«™è«‹æ±‚å½é€ ï¼Œä¹Ÿè¢«ç¨±ç‚º one-click attack æˆ– session ridingï¼Œé€šå¸¸ç¸®å¯«ç‚º CSRF æˆ– XSRFã€‚</p><p>å‡è¨­æœ‰å…©å€‹ä¸åŒç¶²åŸŸ(domain)çš„ç¶²ç«™åŠä¸€ä½ä½¿ç”¨è€…</p><ul><li>A ç¶²ç«™: æƒ¡æ„ç¶²ç«™ï¼Œä¾‹å¦‚å°éŠæˆ²ç¶²ç«™</li><li>B ç¶²ç«™: æ”»æ“Šç›®æ¨™ç¶²ç«™</li><li>ä½¿ç”¨è€…ï¼šè¢«å†’å……èº«ä»½çš„å†¤å¤§é ­ï¼Œæˆ‘å€‘å°±å…ˆå«ä»–å¤§é ­å§</li></ul><p>æ”»æ“Šæµç¨‹ï¼š</p><ol><li>å¤§é ­å·²ç¶“ç™»å…¥é B ç¶²ç«™ä¸¦ä¸”ç€è¦½å™¨ cookie ä¸­åŒ…å«è­˜åˆ¥èº«ä»½çš„ auth token</li><li>é§­å®¢æƒ³è¾¦æ³•è®“å¤§é ­åœ¨ A ç¶²ç«™ä¸Šå° B ç¶²ç«™ç™¼å‡º API è«‹æ±‚ â†’ è·¨ç«™è«‹æ±‚ï¼Œè€Œä¸”é€™å€‹è«‹æ±‚å¸¶è‘— B ç¶²ç«™çš„ cookie åŠ auth tokenâ†’ å½é€ èº«ä»½</li><li>B ç¶²ç«™æ”¶åˆ°è«‹æ±‚ï¼Œç¢ºèª auth token ç¢ºå¯¦æ˜¯å¤§é ­å¾Œç¹¼çºŒåŸ·è¡Œé§­å®¢é æœŸçš„è«‹æ±‚å…§å®¹</li></ol><p>ç”¨é€™å€‹æ–¹å¼å°±å¯ä»¥è®“ä½¿ç”¨è€…ï¼ˆå¤§é ­ï¼‰åœ¨ä½¿ç”¨ A ç¶²ç«™æ™‚å¯èƒ½æ˜¯é»æ“Šä¸€å€‹æŒ‰éˆ•ç”šè‡³æ˜¯è¼‰å…¥ä¸€å¼µåœ–ç‰‡ç„¡æ„é–“å°±ä»¥è‡ªå·±çš„èº«ä»½å° B ç¶²ç«™åŸ·è¡Œæƒ¡æ„æ”»æ“Šï¼Œä¾‹å¦‚åœ¨è‡ªå·±ç™»å…¥éçš„éŠ€è¡Œç¶²ç«™è½‰å¸³ï¼Œå¦‚æœ B ç¶²ç«™ä¹Ÿæ²’å¯Ÿè¦ºå½é€ çš„è«‹æ±‚é‚£é€™å€‹æ”»æ“Šå°±æˆåŠŸäº†ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="å¦‚ä½•è§£æ±º-csrf-æ”»æ“Š"></a>å¦‚ä½•è§£æ±º CSRF æ”»æ“Š<a class="hash-link" href="#å¦‚ä½•è§£æ±º-csrf-æ”»æ“Š" title="Direct link to heading">#</a></h2><ol><li><p>å¾Œç«¯æœå‹™åœ¨ response header <code>Access-Control-Allow-Origin</code> æŒ‡å®šå…è¨±çš„ domainï¼Œç€è¦½å™¨æœƒå…ˆç™¼å‡º preflight è«‹æ±‚çµ¦ server æª¢æŸ¥ client domain æ˜¯å¦è¢«å…è¨±ï¼Œå¦‚æœå…è¨±çš„è©±æ‰æœƒå†ç™¼å‡ºçœŸæ­£çš„è«‹æ±‚ã€‚</p></li><li><p>ç€è¦½å™¨æœƒåœ¨ request header åŠ å…¥<code>Referer</code> åŠ<code>Origin</code> å…©å€‹æ¬„ä½ä»£è¡¨è«‹æ±‚çš„ä¾†æº domainï¼Œserver å¯ä»¥æª¢æŸ¥é€™å…©å€‹æ¬„ä½çš„å€¼æ˜¯ä¸æ˜¯å…è¨±çš„ domainï¼Œé›–ç„¶é€™å…©å€‹æ¬„ä½æ˜¯<a href="https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name" target="_blank" rel="noopener noreferrer">Forbidden header name</a> ï¼Œä½†ä»æœ‰äº›<a href="https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/" target="_blank" rel="noopener noreferrer">å°æŠ€å·§</a>å¯ä»¥ä¿®æ”¹ï¼Œè€Œä¸”æœ‰äº›ç€è¦½å™¨å¯èƒ½æ²’æœ‰é€™å…©å€‹æ¬„ä½ï¼Œæ‰€ä»¥åªç”¨é€™å€‹æ–¹æ³•ä¸¦ä¸å®‰å…¨ã€‚</p></li><li><p>set cookie with <code>SameSite=Strict or Lax</code></p><ul><li>Strict: é€™å€‹ cookie åªæœƒè·Ÿè‘—ç›¸åŒ domain çš„è«‹æ±‚é€å‡ºï¼Œä¸æœƒè·Ÿè‘— cross site request ä¸€èµ·é€å‡ºå»</li><li>Lax: åªå…è¨±ç‰¹å®šæ–¹å¼çš„ cross site request å¯ä»¥ä¸€èµ·å¸¶è‘—é€å‡ºå»ï¼Œç‰¹å®šæ–¹å¼åŒ…å«ï¼š<code>&lt;a&gt;</code>, <code>&lt;link rel=&quot;prerender&quot;&gt;</code>, <code>&lt;form method=&quot;GET&quot;&gt;</code>ï¼ŒChrome set cookie é è¨­<code>SameSite=Lax</code></li></ul></li><li><p>CSRF token: server åŠ å¯†ç”¢ç”Ÿä¸€å€‹å”¯ä¸€ä¸”æœ‰æ™‚æ•ˆæ€§çš„ tokenï¼Œåœ¨å‰ç«¯è¼‰å…¥é é¢æ™‚æˆ–æ˜¯åœ¨å‘¼å«éœ€è¦ä¿è­·çš„ api ä¹‹å‰å…ˆè·Ÿ server å–å¾—é€™å€‹ tokenï¼Œå†æŠŠ token æ”¾é€² api request header ä¸­é€çµ¦ server æª¢æŸ¥æ˜¯åˆæ³• token æ‰æ¥å—è«‹æ±‚ã€‚</p><p>CSRF token å°±åƒæ˜¯ä¸€æ¬¡æ€§ä½¿ç”¨çš„é©—è­‰ç¢¼ä¾†è®“è«‹æ±‚å¤šä¸€å±¤ä¿è­·ï¼Œæ‰€ä»¥ç‰¹åˆ¥éœ€è¦æ³¨æ„å–å¾— CSRF token çš„ api ä¸èƒ½æ¥å—è·¨ç¶²åŸŸçš„è«‹æ±‚ï¼Œå¦‚æœè®“é§­å®¢æœ‰æ©Ÿæœƒå–å¾— CSRF token ä¸€æ¨£æœ‰é¢¨éšªã€‚</p><p>é€™å€‹ä¹Ÿæ˜¯æœ€å¸¸è¦‹çš„æ–¹æ³•ï¼Œå¯¦ä½œä¸Šå¯ä»¥ä½¿ç”¨å¥—ä»¶é”æˆï¼Œä¾‹å¦‚ nodejs çš„<a href="http://expressjs.com/en/resources/middleware/csurf.html" target="_blank" rel="noopener noreferrer">csurf</a>ã€‚</p></li><li><p>Double submit cookie: å‰ç«¯éš¨æ©Ÿç”¢ç”Ÿä¸€å€‹ CSRF tokenï¼ŒåŒæ™‚æ”¾é€² cookie ä»¥åŠæ¯å€‹ request headerï¼Œserver æª¢æŸ¥å…©é‚Šçš„ token æ˜¯ç›¸åŒçš„æ‰æ¥å—è«‹æ±‚ï¼Œå› ç‚ºç€è¦½å™¨çš„è¨­è¨ˆé§­å®¢ç„¡æ³•å°‡å½é€ çš„ token æ”¾é€²ä½ çš„ domain çš„ cookieï¼Œæ­¤æ™‚è·¨ domain è«‹æ±‚æ‰€å¸¶çš„ cookie ä¸­ä¸€å®šæ²’æœ‰æ­£ç¢ºçš„ CSRF tokenã€‚</p></li></ol><p>é€™ç¯‡æ–‡ç« æä¾›äº† 5 å€‹é˜²ç¦¦ CSRF æ”»æ“Šçš„æ–¹æ³•ï¼Œå¯¦å‹™ä¸Šä¹Ÿè¦è€ƒæ…®å“ªäº›æ–¹æ³•é©ç”¨åœ¨ä½ çš„æœå‹™ä¸­ï¼Œå¯ä»¥å–®ç¨ä½¿ç”¨ä¹Ÿå¯ä»¥çµ„åˆä½¿ç”¨å¾—åˆ°æ›´å¥½çš„ä¿è­·ã€‚</p><p>å¦å¤–ï¼Œå°æ–¼ä½¿ç”¨è€…ä¾†èªªé¤Šæˆç™»å‡ºç¶²ç«™çš„å¥½ç¿’æ…£ä¹Ÿå¯ä»¥é™ä½é‡åˆ°çš„é¢¨éšªå–”ï¼</p><p>å¦‚æœæœ‰ä»»ä½•å•é¡Œæˆ–å»ºè­°æ­¡è¿èˆ‡æˆ‘è¯çµ¡è¨è«–ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://medium.com/@Tommmmm/csrf-%E6%94%BB%E6%93%8A%E5%8E%9F%E7%90%86-d0f2a51810ca" target="_blank" rel="noopener noreferrer">CSRF æ”»æ“ŠåŸç†</a></p><p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite" target="_blank" rel="noopener noreferrer">SameSite cookies - HTTP | MDN</a></p><p><a href="https://tech-blog.cymetrics.io/posts/jo/zerobased-cross-site-request-forgery/" target="_blank" rel="noopener noreferrer">é›¶åŸºç¤è³‡å®‰ç³»åˆ—ï¼ˆä¸€ï¼‰-èªè­˜ CSRFï¼ˆCross Site Request Forgeryï¼‰</a></p><p><a href="https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/" target="_blank" rel="noopener noreferrer">Setting the &#x27;Referer&#x27; Header Using JavaScript - TrustedSec</a></p><p><a href="https://auth0.com/blog/cross-site-request-forgery-csrf/#CSRF-Defenses-Strategies" target="_blank" rel="noopener noreferrer">Prevent Cross-Site Request Forgery (CSRF) Attacks</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/csrf">CSRF</a><a class="margin-horiz--sm" href="/tags/cookie">cookie</a><a class="margin-horiz--sm" href="/tags/security">security</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/javascript-deep-dive-into-event-loop">[Javascript] æ·±å…¥äº†è§£äº‹ä»¶è¿´åœˆ(Event Loop)ï¼ŒMacrotaskè·ŸMicrotaskæ˜¯ä»€éº¼ï¼Ÿ</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-06-14T00:00:00.000Z">June 14, 2021</time> Â· 3 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>é›–ç„¶ Javascript æ˜¯ä¸€å€‹å–®ä¸€åŸ·è¡Œç·’(Single Thread)çš„ç¨‹å¼èªè¨€ï¼ŒåŒä¸€æ™‚é–“åªèƒ½åŸ·è¡Œä¸€é …ä»»å‹™ï¼Œä½†å› ç‚ºåº•å±¤<strong>äº‹ä»¶è¿´åœˆ(Event Loop)</strong>é€™å€‹æ©Ÿåˆ¶è®“ä»–æœ‰èƒ½åŠ›ä»¥éåŒæ­¥çš„æ–¹å¼åŒæ™‚è™•ç†å¤šé …ä»»å‹™ï¼Œé€™ç¯‡æ–‡ç« å°‡æœƒæ·±å…¥è§£é‡‹äº‹ä»¶è¿´åœˆï¼Œå¹«åŠ©é–‹ç™¼è€…æ›´æ¸…æ¥šè‡ªå·±å¯«å‡ºçš„ç¨‹å¼ç¢¼æ˜¯å¦‚ä½•åœ¨åº•å±¤é‹ä½œã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/tags/event-loop">event loop</a><a class="margin-horiz--sm" href="/tags/macrotask">macrotask</a><a class="margin-horiz--sm" href="/tags/microtask">microtask</a></div><div class="col text--right"><a aria-label="Read more about [Javascript] æ·±å…¥äº†è§£äº‹ä»¶è¿´åœˆ(Event Loop)ï¼ŒMacrotaskè·ŸMicrotaskæ˜¯ä»€éº¼ï¼Ÿ" href="/javascript-deep-dive-into-event-loop"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/javascript-mutable-vs-immutable-objects">[Javascript] Mutable vs Immutable Objects</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2020-11-22T00:00:00.000Z">November 22, 2020</time> Â· 2 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>ä»‹ç´¹ JavaScript çš„é‡è¦è§€å¿µ <strong>Mutable åŠ Immutable Objects</strong>ï¼Œä¸¦ä»¥ç¯„ä¾‹è§£é‡‹ä»–å€‘çš„å·®åˆ¥ã€‚</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/tags/mutable">mutable</a><a class="margin-horiz--sm" href="/tags/immutable">immutable</a></div><div class="col text--right"><a aria-label="Read more about [Javascript] Mutable vs Immutable Objects" href="/javascript-mutable-vs-immutable-objects"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></main></div></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Eric Deng. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.602d08e5.js"></script>
<script src="/assets/js/main.bf8d4acf.js"></script>
</body>
</html>